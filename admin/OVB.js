!function e(t,n,i){function o(s,a){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(r)return r(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var u=n[s]={exports:{}};t[s][0].call(u.exports,(function(e){return o(t[s][1][e]||e)}),u,u.exports,e,t,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(e,t,n){function i(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=v(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}function o(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function r(e,t,n){if(t)e.call(n);else for(var i=e.length,o=m(e,i),r=0;r<i;++r)o[r].call(n)}function s(e,t,n,i){if(t)e.call(n,i);else for(var o=e.length,r=m(e,o),s=0;s<o;++s)r[s].call(n,i)}function a(e,t,n,i,o){if(t)e.call(n,i,o);else for(var r=e.length,s=m(e,r),a=0;a<r;++a)s[a].call(n,i,o)}function c(e,t,n,i,o,r){if(t)e.call(n,i,o,r);else for(var s=e.length,a=m(e,s),c=0;c<s;++c)a[c].call(n,i,o,r)}function d(e,t,n,i){if(t)e.apply(n,i);else for(var o=e.length,r=m(e,o),s=0;s<o;++s)r[s].apply(n,i)}function u(e,t,n,i){var r,s,a;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),a=s[t]):(s=e._events=v(null),e._eventsCount=0),a){if("function"==typeof a?a=s[t]=i?[n,a]:[a,n]:i?a.unshift(n):a.push(n),!a.warned&&(r=o(e))&&r>0&&a.length>r){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=a.length,"object"==typeof console&&console.warn}}else a=s[t]=n,++e._eventsCount;return e}function p(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function l(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=E.call(p,i);return o.listener=n,i.wrapFn=o,o}function f(e,t,n){var i=e._events;if(!i)return[];var o=i[t];return o?"function"==typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(o):m(o,o.length):[]}function h(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function m(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}var v=Object.create||function(e){var t=function(){};return t.prototype=e,new t},b=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return n},E=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0;var y,g=10;try{var S={};Object.defineProperty&&Object.defineProperty(S,"x",{value:0}),y=0===S.x}catch(e){y=!1}y?Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return g},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');g=e}}):i.defaultMaxListeners=g,i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return o(this)},i.prototype.emit=function(e){var t,n,i,o,u,p,l="error"===e;if(p=this._events)l=l&&null==p.error;else if(!l)return!1;if(l){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var f=new Error('Unhandled "error" event. ('+t+")");throw f.context=t,f}if(!(n=p[e]))return!1;var h="function"==typeof n;switch(i=arguments.length){case 1:r(n,h,this);break;case 2:s(n,h,this,arguments[1]);break;case 3:a(n,h,this,arguments[1],arguments[2]);break;case 4:c(n,h,this,arguments[1],arguments[2],arguments[3]);break;default:for(o=new Array(i-1),u=1;u<i;u++)o[u-1]=arguments[u];d(n,h,this,o)}return!0},i.prototype.addListener=function(e,t){return u(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return u(this,e,t,!0)},i.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,l(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,l(this,e,t)),this},i.prototype.removeListener=function(e,t){var n,i,o,r,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=v(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,r=n.length-1;r>=0;r--)if(n[r]===t||n[r].listener===t){s=n[r].listener,o=r;break}if(o<0)return this;0===o?n.shift():function(e,t){for(var n=t,i=n+1,o=e.length;i<o;n+=1,i+=1)e[n]=e[i];e.pop()}(n,o),1===n.length&&(i[e]=n[0]),i.removeListener&&this.emit("removeListener",e,s||t)}return this},i.prototype.removeAllListeners=function(e){var t,n,i;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=v(null),this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=v(null):delete n[e]),this;if(0===arguments.length){var o,r=b(n);for(i=0;i<r.length;++i)"removeListener"!==(o=r[i])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=v(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},i.prototype.listeners=function(e){return f(this,e,!0)},i.prototype.rawListeners=function(e){return f(this,e,!1)},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},i.prototype.listenerCount=h,i.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],2:[function(e,t,n){"use strict";var i=e("normalice");t.exports=function(t){function n(e,t){for(var n,o=[],s=[].concat(r[e]);s.length&&o.length<t;)n=Math.random()*s.length|0,o=o.concat(s.splice(n,1));return o.map((function(t){return"string"==typeof t||t instanceof String?i(e+":"+t):t}))}var o,r={stun:(t||{}).stun||e("./stun.json"),turn:(t||{}).turn||e("./turn.json")},s=(t||{}).stunCount||2,a=(t||{}).turnCount||0;return o=[].concat(n("stun",s)),a&&(o=o.concat(n("turn",a))),o}},{"./stun.json":3,"./turn.json":4,normalice:7}],3:[function(e,t,n){t.exports=["stun.l.google.com:19302","stun1.l.google.com:19302","stun2.l.google.com:19302","stun3.l.google.com:19302","stun4.l.google.com:19302","stun.ekiga.net","stun.ideasip.com","stun.schlund.de","stun.stunprotocol.org:3478","stun.voiparound.com","stun.voipbuster.com","stun.voipstunt.com","stun.voxgratia.org"]},{}],4:[function(e,t,n){t.exports=[]},{}],5:[function(e,t,n){var i,o=e("wildemitter");"undefined"!=typeof window&&(i=window.AudioContext||window.webkitAudioContext);var r=null;t.exports=function(e,t){var n=new o;if(!i)return n;var s,a,c,d=(t=t||{}).smoothing||.1,u=t.interval||50,p=t.threshold,l=t.play,f=t.history||10,h=!0;r=t.audioContext||r||new i,(c=r.createAnalyser()).fftSize=512,c.smoothingTimeConstant=d,a=new Float32Array(c.frequencyBinCount),e.jquery&&(e=e[0]),e instanceof HTMLAudioElement||e instanceof HTMLVideoElement?(s=r.createMediaElementSource(e),void 0===l&&(l=!0),p=p||-50):(s=r.createMediaStreamSource(e),p=p||-50),s.connect(c),l&&c.connect(r.destination),n.speaking=!1,n.suspend=function(){return r.suspend()},n.resume=function(){return r.resume()},Object.defineProperty(n,"state",{get:function(){return r.state}}),r.onstatechange=function(){n.emit("state_change",r.state)},n.setThreshold=function(e){p=e},n.setInterval=function(e){u=e},n.stop=function(){h=!1,n.emit("volume_change",-100,p),n.speaking&&(n.speaking=!1,n.emit("stopped_speaking")),c.disconnect(),s.disconnect()},n.speakingHistory=[];for(var m=0;m<f;m++)n.speakingHistory.push(0);var v=function(){setTimeout((function(){if(h){var e=function(e,t){var n=-1/0;e.getFloatFrequencyData(t);for(var i=4,o=t.length;i<o;i++)t[i]>n&&t[i]<0&&(n=t[i]);return n}(c,a);n.emit("volume_change",e,p);var t=0;if(e>p&&!n.speaking){for(var i=n.speakingHistory.length-3;i<n.speakingHistory.length;i++)t+=n.speakingHistory[i];t>=2&&(n.speaking=!0,n.emit("speaking"))}else if(e<p&&n.speaking){for(i=0;i<n.speakingHistory.length;i++)t+=n.speakingHistory[i];0==t&&(n.speaking=!1,n.emit("stopped_speaking"))}n.speakingHistory.shift(),n.speakingHistory.push(0+(e>p)),v()}}),u)};return v(),n}},{wildemitter:14}],6:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},{}],7:[function(e,t,n){var i=["stun:","turn:"];t.exports=function(e){var t,n,o=(e||{}).url||e,r={};return"string"==typeof o||o instanceof String?(o=o.trim(),(t=i[i.indexOf(o.slice(0,5))])?(n=(o=o.slice(5)).split("@"),r.username=e.username,r.credential=e.credential,n.length>1&&(o=n[1],n=n[0].split(":"),r.username=n[0],r.credential=(e||{}).credential||n[1]||""),r.url=t+o,r.urls=[r.url],r):e):e}},{}],8:[function(e,t,n){(function(e){(function(){"use strict";function i(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function o(e){return e=d(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:i(e)}function r(e,t){for(var n in e)E.call(e,n)&&t(e[n],n,e)}function s(e){return null==e?i(e):y.call(e).slice(8,-1)}function a(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function c(e,t){var n=null;return function(e,t){var n=-1,i=e?e.length:0;if("number"==typeof i&&i>-1&&i<=m)for(;++n<i;)t(e[n],n);else r(e,t)}(e,(function(i,o){n=t(n,i,o,e)})),n}function d(e){return String(e).replace(/^ +| +$/g,"")}var u={function:!0,object:!0},p=u[typeof window]&&window||this,l=u[typeof n]&&n,f=u[typeof t]&&t&&!t.nodeType&&t,h=l&&f&&"object"==typeof e&&e;!h||h.global!==h&&h.window!==h&&h.self!==h||(p=h);var m=Math.pow(2,53)-1,v=/\bOpera/,b=Object.prototype,E=b.hasOwnProperty,y=b.toString,g=function e(t){function n(e){return c(e,(function(e,n){var i=n.pattern||a(n);return!e&&(e=RegExp("\\b"+i+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+i+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+i+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((e=String(n.label&&!RegExp(i,"i").test(n.label)?n.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),n=n.label||n,e=o(e[0].replace(RegExp(i,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),e}))}var i=p,u=t&&"object"==typeof t&&"String"!=s(t);u&&(i=t,t=null);var l=i.navigator||{},f=l.userAgent||"";t||(t=f);var h,m,b=u?!!l.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(y.toString()),E="Object",g=u?E:"ScriptBridgingProxyObject",S=u?E:"Environment",w=u&&i.java?"JavaPackage":s(i.java),O=u?E:"RuntimeObject",R=/\bJava/.test(w)&&i.java,I=R&&s(i.environment)==S,C=R?"a":"α",P=R?"b":"β",k=i.document||{},_=i.operamini||i.opera,T=v.test(T=u&&_?_["[[Class]]"]:s(_))?T:_=null,V=t,M=[],D=null,N=t==f,x=N&&_&&"function"==typeof _.version&&_.version(),A=c([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],(function(e,n){return e||RegExp("\\b"+(n.pattern||a(n))+"\\b","i").exec(t)&&(n.label||n)})),L=c(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"],(function(e,n){return e||RegExp("\\b"+(n.pattern||a(n))+"\\b","i").exec(t)&&(n.label||n)})),j=n([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),F=c({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}},(function(e,n,i){return e||(n[j]||n[/^[a-z]+(?: +[a-z]+\b)*/i.exec(j)]||RegExp("\\b"+a(i)+"(?:\\b|\\w*\\d)","i").exec(t))&&i})),W=c(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "],(function(e,n){var i=n.pattern||a(n);return!e&&(e=RegExp("\\b"+i+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(e=function(e,t,n){var i={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&n&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(i=i[/[\d.]+$/.exec(e)])&&(e="Windows "+i),e=String(e),t&&n&&(e=e.replace(RegExp(t,"i"),n)),e=o(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,i,n.label||n)),e}));if(A&&(A=[A]),F&&!j&&(j=n([F])),(h=/\bGoogle TV\b/.exec(j))&&(j=h[0]),/\bSimulator\b/i.test(t)&&(j=(j?j+" ":"")+"Simulator"),"Opera Mini"==L&&/\bOPiOS\b/.test(t)&&M.push("running in Turbo/Uncompressed mode"),"IE"==L&&/\blike iPhone OS\b/.test(t)?(F=(h=e(t.replace(/like iPhone OS/,""))).manufacturer,j=h.product):/^iP/.test(j)?(L||(L="Safari"),W="iOS"+((h=/ OS ([\d_]+)/i.exec(t))?" "+h[1].replace(/_/g,"."):"")):"Konqueror"!=L||/buntu/i.test(W)?F&&"Google"!=F&&(/Chrome/.test(L)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(j))||/\bAndroid\b/.test(W)&&/^Chrome/.test(L)&&/\bVersion\//i.test(t)?(L="Android Browser",W=/\bAndroid\b/.test(W)?W:"Android"):"Silk"==L?(/\bMobi/i.test(t)||(W="Android",M.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&M.unshift("accelerated")):"PaleMoon"==L&&(h=/\bFirefox\/([\d.]+)\b/.exec(t))?M.push("identifying as Firefox "+h[1]):"Firefox"==L&&(h=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(W||(W="Firefox OS"),j||(j=h[1])):!L||(h=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(L))?(L&&!j&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(h+"/")+8))&&(L=null),(h=j||F||W)&&(j||F||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(W))&&(L=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(W)?W:h)+" Browser")):"Electron"==L&&(h=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&M.push("Chromium "+h):W="Kubuntu",x||(x=function(e){return c(e,(function(e,n){return e||(RegExp(n+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))}(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",a(L),"(?:Firefox|Minefield|NetFront)"])),(h=("iCab"==A&&parseFloat(x)>3?"WebKit":/\bOpera\b/.test(L)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(A)&&"WebKit"||!A&&/\bMSIE\b/i.test(t)&&("Mac OS"==W?"Tasman":"Trident")||"WebKit"==A&&/\bPlayStation\b(?! Vita\b)/i.test(L)&&"NetFront")&&(A=[h]),"IE"==L&&(h=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(L+=" Mobile",W="Windows Phone "+(/\+$/.test(h)?h:h+".x"),M.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(L="IE Mobile",W="Windows Phone 8.x",M.unshift("desktop mode"),x||(x=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=L&&"Trident"==A&&(h=/\brv:([\d.]+)/.exec(t))&&(L&&M.push("identifying as "+L+(x?" "+x:"")),L="IE",x=h[1]),N){if(function(e,t){var n=null!=e?typeof e[t]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(n)||"object"==n&&!e[t])}(i,"global"))if(R&&(V=(h=R.lang.System).getProperty("os.arch"),W=W||h.getProperty("os.name")+" "+h.getProperty("os.version")),I){try{x=i.require("ringo/engine").version.join("."),L="RingoJS"}catch(t){(h=i.system)&&h.global.system==i.system&&(L="Narwhal",W||(W=h[0].os||null))}L||(L="Rhino")}else"object"==typeof i.process&&!i.process.browser&&(h=i.process)&&("object"==typeof h.versions&&("string"==typeof h.versions.electron?(M.push("Node "+h.versions.node),L="Electron",x=h.versions.electron):"string"==typeof h.versions.nw&&(M.push("Chromium "+x,"Node "+h.versions.node),L="NW.js",x=h.versions.nw)),L||(L="Node.js",V=h.arch,W=h.platform,x=(x=/[\d.]+/.exec(h.version))?x[0]:null));else s(h=i.runtime)==g?(L="Adobe AIR",W=h.flash.system.Capabilities.os):s(h=i.phantom)==O?(L="PhantomJS",x=(h=h.version||null)&&h.major+"."+h.minor+"."+h.patch):"number"==typeof k.documentMode&&(h=/\bTrident\/(\d+)/i.exec(t))?(x=[x,k.documentMode],(h=+h[1]+4)!=x[1]&&(M.push("IE "+x[1]+" mode"),A&&(A[1]=""),x[1]=h),x="IE"==L?String(x[1].toFixed(1)):x[0]):"number"==typeof k.documentMode&&/^(?:Chrome|Firefox)\b/.test(L)&&(M.push("masking as "+L+" "+x),L="IE",x="11.0",A=["Trident"],W="Windows");W=W&&o(W)}if(x&&(h=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(x)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(N&&l.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(D=/b/i.test(h)?"beta":"alpha",x=x.replace(RegExp(h+"\\+?$"),"")+("beta"==D?P:C)+(/\d+\+?/.exec(h)||"")),"Fennec"==L||"Firefox"==L&&/\b(?:Android|Firefox OS)\b/.test(W))L="Firefox Mobile";else if("Maxthon"==L&&x)x=x.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(j))"Xbox 360"==j&&(W=null),"Xbox 360"==j&&/\bIEMobile\b/.test(t)&&M.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(L)&&(!L||j||/Browser|Mobi/.test(L))||"Windows CE"!=W&&!/Mobi/i.test(t))if("IE"==L&&N)try{null===i.external&&M.unshift("platform preview")}catch(t){M.unshift("embedded")}else(/\bBlackBerry\b/.test(j)||/\bBB10\b/.test(t))&&(h=(RegExp(j.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||x)?(W=((h=[h,/BB10/.test(t)])[1]?(j=null,F="BlackBerry"):"Device Software")+" "+h[0],x=null):this!=r&&"Wii"!=j&&(N&&_||/Opera/.test(L)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==L&&/\bOS X (?:\d+\.){2,}/.test(W)||"IE"==L&&(W&&!/^Win/.test(W)&&x>5.5||/\bWindows XP\b/.test(W)&&x>8||8==x&&!/\bTrident\b/.test(t)))&&!v.test(h=e.call(r,t.replace(v,"")+";"))&&h.name&&(h="ing as "+h.name+((h=h.version)?" "+h:""),v.test(L)?(/\bIE\b/.test(h)&&"Mac OS"==W&&(W=null),h="identify"+h):(h="mask"+h,L=T?o(T.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(h)&&(W=null),N||(x=null)),A=["Presto"],M.push(h));else L+=" Mobile";(h=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(h=[parseFloat(h.replace(/\.(\d)$/,".0$1")),h],"Safari"==L&&"+"==h[1].slice(-1)?(L="WebKit Nightly",D="alpha",x=h[1].slice(0,-1)):x!=h[1]&&x!=(h[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(x=null),h[1]=(/\bChrome\/([\d.]+)/i.exec(t)||0)[1],537.36==h[0]&&537.36==h[2]&&parseFloat(h[1])>=28&&"WebKit"==A&&(A=["Blink"]),N&&(b||h[1])?(A&&(A[1]="like Chrome"),h=h[1]||((h=h[0])<530?1:h<532?2:h<532.05?3:h<533?4:h<534.03?5:h<534.07?6:h<534.1?7:h<534.13?8:h<534.16?9:h<534.24?10:h<534.3?11:h<535.01?12:h<535.02?"13+":h<535.07?15:h<535.11?16:h<535.19?17:h<536.05?18:h<536.1?19:h<537.01?20:h<537.11?"21+":h<537.13?23:h<537.18?24:h<537.24?25:h<537.36?26:"Blink"!=A?"27":"28")):(A&&(A[1]="like Safari"),h=(h=h[0])<400?1:h<500?2:h<526?3:h<533?4:h<534?"4+":h<535?5:h<537?6:h<538?7:h<601?8:"8"),A&&(A[1]+=" "+(h+="number"==typeof h?".x":/[.+]/.test(h)?"":"+")),"Safari"==L&&(!x||parseInt(x)>45)&&(x=h)),"Opera"==L&&(h=/\bzbov|zvav$/.exec(W))?(L+=" ",M.unshift("desktop mode"),"zvav"==h?(L+="Mini",x=null):L+="Mobile",W=W.replace(RegExp(" *"+h+"$"),"")):"Safari"==L&&/\bChrome\b/.exec(A&&A[1])&&(M.unshift("desktop mode"),L="Chrome Mobile",x=null,/\bOS X\b/.test(W)?(F="Apple",W="iOS 4.3+"):W=null),x&&0==x.indexOf(h=/[\d.]+$/.exec(W))&&t.indexOf("/"+h+"-")>-1&&(W=d(W.replace(h,""))),A&&!/\b(?:Avant|Nook)\b/.test(L)&&(/Browser|Lunascape|Maxthon/.test(L)||"Safari"!=L&&/^iOS/.test(W)&&/\bSafari\b/.test(A[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(L)&&A[1])&&(h=A[A.length-1])&&M.push(h),M.length&&(M=["("+M.join("; ")+")"]),F&&j&&j.indexOf(F)<0&&M.push("on "+F),j&&M.push((/^on /.test(M[M.length-1])?"":"on ")+j),W&&(h=/ ([\d.+]+)$/.exec(W),m=h&&"/"==W.charAt(W.length-h[0].length-1),W={architecture:32,family:h&&!m?W.replace(h[0],""):W,version:h?h[1]:null,toString:function(){var e=this.version;return this.family+(e&&!m?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(h=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(V))&&!/\bi686\b/i.test(V)?(W&&(W.architecture=64,W.family=W.family.replace(RegExp(" *"+h),"")),L&&(/\bWOW64\b/i.test(t)||N&&/\w(?:86|32)$/.test(l.cpuClass||l.platform)&&!/\bWin64; x64\b/i.test(t))&&M.unshift("32-bit")):W&&/^OS X/.test(W.family)&&"Chrome"==L&&parseFloat(x)>=39&&(W.architecture=64),t||(t=null);var U={};return U.description=t,U.layout=A&&A[0],U.manufacturer=F,U.name=L,U.prerelease=D,U.product=j,U.ua=t,U.version=L&&x,U.os=W||{architecture:null,family:null,version:null,toString:function(){return"null"}},U.parse=e,U.toString=function(){return this.description||""},U.version&&M.unshift(x),U.name&&M.unshift(L),W&&L&&(W!=String(W).split(" ")[0]||W!=L.split(" ")[0]&&!j)&&M.push(j?"("+W+")":"on "+W),M.length&&(U.description=M.join(" ")),U}();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(p.platform=g,define((function(){return g}))):l&&f?r(g,(function(e,t){l[t]=e})):p.platform=g}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(e,t,n){var i=e("./v1"),o=e("./v4"),r=o;r.v1=i,r.v4=o,t.exports=r},{"./v1":12,"./v4":13}],10:[function(e,t,n){for(var i=[],o=0;o<256;++o)i[o]=(o+256).toString(16).substr(1);t.exports=function(e,t){var n=t||0,o=i;return[o[e[n++]],o[e[n++]],o[e[n++]],o[e[n++]],"-",o[e[n++]],o[e[n++]],"-",o[e[n++]],o[e[n++]],"-",o[e[n++]],o[e[n++]],"-",o[e[n++]],o[e[n++]],o[e[n++]],o[e[n++]],o[e[n++]],o[e[n++]]].join("")}},{}],11:[function(e,t,n){var i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(i){var o=new Uint8Array(16);t.exports=function(){return i(o),o}}else{var r=new Array(16);t.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}},{}],12:[function(e,t,n){var i,o,r=e("./lib/rng"),s=e("./lib/bytesToUuid"),a=0,c=0;t.exports=function(e,t,n){var d=t&&n||0,u=t||[],p=(e=e||{}).node||i,l=void 0!==e.clockseq?e.clockseq:o;if(null==p||null==l){var f=r();null==p&&(p=i=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==l&&(l=o=16383&(f[6]<<8|f[7]))}var h=void 0!==e.msecs?e.msecs:(new Date).getTime(),m=void 0!==e.nsecs?e.nsecs:c+1,v=h-a+(m-c)/1e4;if(v<0&&void 0===e.clockseq&&(l=l+1&16383),(v<0||h>a)&&void 0===e.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=h,c=m,o=l;var b=(1e4*(268435455&(h+=122192928e5))+m)%4294967296;u[d++]=b>>>24&255,u[d++]=b>>>16&255,u[d++]=b>>>8&255,u[d++]=255&b;var E=h/4294967296*1e4&268435455;u[d++]=E>>>8&255,u[d++]=255&E,u[d++]=E>>>24&15|16,u[d++]=E>>>16&255,u[d++]=l>>>8|128,u[d++]=255&l;for(var y=0;y<6;++y)u[d+y]=p[y];return t||s(u)}},{"./lib/bytesToUuid":10,"./lib/rng":11}],13:[function(e,t,n){var i=e("./lib/rng"),o=e("./lib/bytesToUuid");t.exports=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||i)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[r+a]=s[a];return t||o(s)}},{"./lib/bytesToUuid":10,"./lib/rng":11}],14:[function(e,t,n){function i(){}t.exports=i,i.mixin=function(e){var t=e.prototype||e;t.isWildEmitter=!0,t.on=function(e,t,n){this.callbacks=this.callbacks||{};var i=3===arguments.length,o=i?arguments[1]:void 0,r=i?arguments[2]:arguments[1];return r._groupName=o,(this.callbacks[e]=this.callbacks[e]||[]).push(r),this},t.once=function(e,t,n){function i(){o.off(e,i),a.apply(this,arguments)}var o=this,r=3===arguments.length,s=r?arguments[1]:void 0,a=r?arguments[2]:arguments[1];return this.on(e,s,i),this},t.releaseGroup=function(e){var t,n,i,o;for(t in this.callbacks=this.callbacks||{},this.callbacks)for(n=0,i=(o=this.callbacks[t]).length;n<i;n++)o[n]._groupName===e&&(o.splice(n,1),n--,i--);return this},t.off=function(e,t){this.callbacks=this.callbacks||{};var n,i=this.callbacks[e];return i?1===arguments.length?(delete this.callbacks[e],this):(-1!==(n=i.indexOf(t))&&(i.splice(n,1),0===i.length&&delete this.callbacks[e]),this):this},t.emit=function(e){this.callbacks=this.callbacks||{};var t,n,i,o=[].slice.call(arguments,1),r=this.callbacks[e],s=this.getWildcardCallbacks(e);if(r)for(t=0,n=(i=r.slice()).length;t<n&&i[t];++t)i[t].apply(this,o);if(s)for(n=s.length,t=0,n=(i=s.slice()).length;t<n&&i[t];++t)i[t].apply(this,[e].concat(o));return this},t.getWildcardCallbacks=function(e){this.callbacks=this.callbacks||{};var t,n,i=[];for(t in this.callbacks)n=t.split("*"),("*"===t||2===n.length&&e.slice(0,n[0].length)===n[0])&&(i=i.concat(this.callbacks[t]));return i}},i.mixin(i)},{}],15:[function(e,t,n){!function(e){"use strict";function n(){}function i(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function o(e){return function(){return this[e].apply(this,arguments)}}function r(e){return"function"==typeof e||e instanceof RegExp||!(!e||"object"!=typeof e)&&r(e.listener)}var s=n.prototype,a=e.EventEmitter;s.getListeners=function(e){var t,n,i=this._getEvents();if(e instanceof RegExp)for(n in t={},i)i.hasOwnProperty(n)&&e.test(n)&&(t[n]=i[n]);else t=i[e]||(i[e]=[]);return t},s.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},s.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&((t={})[e]=n),t||n},s.addListener=function(e,t){if(!r(t))throw new TypeError("listener must be a function");var n,o=this.getListenersAsObject(e),s="object"==typeof t;for(n in o)o.hasOwnProperty(n)&&-1===i(o[n],t)&&o[n].push(s?t:{listener:t,once:!1});return this},s.on=o("addListener"),s.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},s.once=o("addOnceListener"),s.defineEvent=function(e){return this.getListeners(e),this},s.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},s.removeListener=function(e,t){var n,o,r=this.getListenersAsObject(e);for(o in r)r.hasOwnProperty(o)&&-1!==(n=i(r[o],t))&&r[o].splice(n,1);return this},s.off=o("removeListener"),s.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},s.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},s.manipulateListeners=function(e,t,n){var i,o,r=e?this.removeListener:this.addListener,s=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(i=n.length;i--;)r.call(this,t,n[i]);else for(i in t)t.hasOwnProperty(i)&&(o=t[i])&&("function"==typeof o?r.call(this,i,o):s.call(this,i,o));return this},s.removeEvent=function(e){var t,n=typeof e,i=this._getEvents();if("string"===n)delete i[e];else if(e instanceof RegExp)for(t in i)i.hasOwnProperty(t)&&e.test(t)&&delete i[t];else delete this._events;return this},s.removeAllListeners=o("removeEvent"),s.emitEvent=function(e,t){var n,i,o,r,s=this.getListenersAsObject(e);for(r in s)if(s.hasOwnProperty(r))for(n=s[r].slice(0),o=0;o<n.length;o++)!0===(i=n[o]).once&&this.removeListener(e,i.listener),i.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,i.listener);return this},s.trigger=o("emitEvent"),s.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},s.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},s._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},s._getEvents=function(){return this._events||(this._events={})},n.noConflict=function(){return e.EventEmitter=a,n},"function"==typeof define&&define.amd?define((function(){return n})):"object"==typeof t&&t.exports?t.exports=n:e.EventEmitter=n}("undefined"!=typeof window?window:this||{})},{}],16:[function(e,t,n){t.exports={author:"OpenVidu",dependencies:{"@types/node":"12.6.8","@types/platform":"1.3.2",freeice:"2.2.2",hark:"1.2.3",platform:"1.3.5",uuid:"3.3.2","wolfy87-eventemitter":"5.2.6"},description:"OpenVidu Browser",devDependencies:{browserify:"16.3.0",grunt:"1.0.4","grunt-autoprefixer":"3.0.4","grunt-cli":"1.3.2","grunt-contrib-copy":"1.0.0","grunt-contrib-sass":"1.0.0","grunt-contrib-uglify":"4.0.1","grunt-contrib-watch":"1.1.0","grunt-string-replace":"1.3.1","grunt-ts":"6.0.0-beta.22",tsify:"4.0.1",tslint:"5.18.0",typedoc:"0.15.0",typescript:"3.5.3","uglify-js":"3.6.0"},license:"Apache-2.0",main:"lib/index.js",name:"openvidu-browser",repository:{type:"git",url:"git://github.com/OpenVidu/openvidu"},scripts:{browserify:"VERSION=${VERSION:-}; cd src && ../node_modules/browserify/bin/cmd.js Main.ts -p [ tsify ] --exclude kurento-browser-extensions --debug -o ../static/js/openvidu-browser-$VERSION.js -v","browserify-prod":"VERSION=${VERSION:-}; cd src && ../node_modules/browserify/bin/cmd.js --debug Main.ts -p [ tsify ] --exclude kurento-browser-extensions | ../node_modules/uglify-js/bin/uglifyjs --source-map content=inline --output ../static/js/openvidu-browser-$VERSION.min.js",build:"cd src/OpenVidu && ./../../node_modules/typescript/bin/tsc && cd ../.. && ./node_modules/typescript/bin/tsc --declaration src/index.ts --outDir ./lib --sourceMap --lib dom,es5,es2015.promise,scripthost",docs:"./node_modules/typedoc/bin/typedoc --options ./config/typedoc.js --out ./docs ./src && rm -rf ../../openvidu.io/api/openvidu-browser/* && cp -R ./docs/. ../../openvidu.io/api/openvidu-browser",test:'echo "Error: no test specified" && exit 1'},types:"lib/index.d.ts",version:"2.11.0"}},{}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("./OpenVidu/OpenVidu");window&&(window.OpenVidu=i.OpenVidu)},{"./OpenVidu/OpenVidu":21}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("./Stream"),o=function(){function e(e,t){this.session=e,this.disposed=!1,t&&(t.id,this.options=t,this.connectionId=t.id,this.creationTime=t.createdAt,t.metadata&&(this.data=t.metadata),t.streams&&this.initRemoteStreams(t.streams))}return e.prototype.sendIceCandidate=function(e){this.session.openvidu.sendRequest("onIceCandidate",{endpointName:this.connectionId,candidate:e.candidate,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex},(function(e,t){}))},e.prototype.initRemoteStreams=function(e){var t=this;e.forEach((function(e){var n={id:e.id,createdAt:e.createdAt,connection:t,hasAudio:e.hasAudio,hasVideo:e.hasVideo,audioActive:e.audioActive,videoActive:e.videoActive,typeOfVideo:e.typeOfVideo,frameRate:e.frameRate,videoDimensions:e.videoDimensions?JSON.parse(e.videoDimensions):void 0,filter:e.filter?e.filter:void 0},o=new i.Stream(t.session,n);t.addStream(o)}))},e.prototype.addStream=function(e){e.connection=this,this.stream=e},e.prototype.removeStream=function(e){delete this.stream},e.prototype.dispose=function(){this.stream&&delete this.stream,this.disposed=!0},e}();n.Connection=o},{"./Stream":24}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../OpenViduInternal/Events/StreamPropertyChangedEvent"),o=e("../OpenViduInternal/Enums/OpenViduError"),r=function(){function e(e,t){this.handlers={},this.type=e,this.options=t}return e.prototype.execMethod=function(e,t){var n=this;return new Promise((function(r,s){var a;if("string"!=typeof t)try{a=JSON.stringify(t)}catch(e){s("'params' property must be a JSON formatted object")}else a=t;n.stream.session.openvidu.sendRequest("execFilterMethod",{streamId:n.stream.streamId,method:e,params:a},(function(t,c){if(t)401===t.code?s(new o.OpenViduError(o.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to execute a filter method")):s(t);else{var d=Object.assign({},n.stream.filter);n.stream.filter.lastExecMethod={method:e,params:JSON.parse(a)},n.stream.session.emitEvent("streamPropertyChanged",[new i.StreamPropertyChangedEvent(n.stream.session,n.stream,"filter",n.stream.filter,d,"execFilterMethod")]),n.stream.streamManager.emitEvent("streamPropertyChanged",[new i.StreamPropertyChangedEvent(n.stream.streamManager,n.stream,"filter",n.stream.filter,d,"execFilterMethod")]),r()}}))}))},e.prototype.addEventListener=function(e,t){var n=this;return new Promise((function(i,r){n.stream.session.openvidu.sendRequest("addFilterEventListener",{streamId:n.stream.streamId,eventType:e},(function(s,a){s?401===s.code?r(new o.OpenViduError(o.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to add a filter event listener")):r(s):(n.handlers[e]=t,i())}))}))},e.prototype.removeEventListener=function(e){var t=this;return new Promise((function(n,i){t.stream.session.openvidu.sendRequest("removeFilterEventListener",{streamId:t.stream.streamId,eventType:e},(function(r,s){r?401===r.code?i(new o.OpenViduError(o.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to add a filter event listener")):i(r):(delete t.handlers[e],n())}))}))},e}();n.Filter=r},{"../OpenViduInternal/Enums/OpenViduError":28,"../OpenViduInternal/Events/StreamPropertyChangedEvent":39}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../OpenViduInternal/Enums/LocalRecorderState"),o=e("platform"),r=function(){function e(e){this.stream=e,this.chunks=[],this.connectionId=this.stream.connection?this.stream.connection.connectionId:"default-connection",this.id=this.stream.streamId+"_"+this.connectionId+"_localrecord",this.state=i.LocalRecorderState.READY}return e.prototype.record=function(){var e=this;return new Promise((function(t,n){try{if("undefined"==typeof MediaRecorder)throw Error("MediaRecorder not supported on your browser. See compatibility in https://caniuse.com/#search=MediaRecorder");if(e.state!==i.LocalRecorderState.READY)throw Error("'LocalRecord.record()' needs 'LocalRecord.state' to be 'READY' (current value: '"+e.state+"'). Call 'LocalRecorder.clean()' or init a new LocalRecorder before");if("function"==typeof MediaRecorder.isTypeSupported){var o=void 0;MediaRecorder.isTypeSupported("video/webm;codecs=vp9")?o={mimeType:"video/webm;codecs=vp9"}:MediaRecorder.isTypeSupported("video/webm;codecs=h264")?o={mimeType:"video/webm;codecs=h264"}:MediaRecorder.isTypeSupported("video/webm;codecs=vp8")&&(o={mimeType:"video/webm;codecs=vp8"}),e.mediaRecorder=new MediaRecorder(e.stream.getMediaStream(),o)}else e.mediaRecorder=new MediaRecorder(e.stream.getMediaStream());e.mediaRecorder.start(10)}catch(e){n(e)}e.mediaRecorder.ondataavailable=function(t){e.chunks.push(t.data)},e.mediaRecorder.onerror=function(e){},e.mediaRecorder.onstart=function(){},e.mediaRecorder.onstop=function(){e.onStopDefault()},e.mediaRecorder.onpause=function(){},e.mediaRecorder.onresume=function(){},e.mediaRecorder.onwarning=function(e){},e.state=i.LocalRecorderState.RECORDING,t()}))},e.prototype.stop=function(){var e=this;return new Promise((function(t,n){try{if(e.state===i.LocalRecorderState.READY||e.state===i.LocalRecorderState.FINISHED)throw Error("'LocalRecord.stop()' needs 'LocalRecord.state' to be 'RECORDING' or 'PAUSED' (current value: '"+e.state+"'). Call 'LocalRecorder.start()' before");e.mediaRecorder.onstop=function(){e.onStopDefault(),t()},e.mediaRecorder.stop()}catch(e){n(e)}}))},e.prototype.pause=function(){var e=this;return new Promise((function(t,n){try{e.state!==i.LocalRecorderState.RECORDING&&n(Error("'LocalRecord.pause()' needs 'LocalRecord.state' to be 'RECORDING' (current value: '"+e.state+"'). Call 'LocalRecorder.start()' or 'LocalRecorder.resume()' before")),e.mediaRecorder.pause(),e.state=i.LocalRecorderState.PAUSED}catch(e){n(e)}}))},e.prototype.resume=function(){var e=this;return new Promise((function(t,n){try{if(e.state!==i.LocalRecorderState.PAUSED)throw Error("'LocalRecord.resume()' needs 'LocalRecord.state' to be 'PAUSED' (current value: '"+e.state+"'). Call 'LocalRecorder.pause()' before");e.mediaRecorder.resume(),e.state=i.LocalRecorderState.RECORDING}catch(e){n(e)}}))},e.prototype.preview=function(e){if(this.state!==i.LocalRecorderState.FINISHED)throw Error("'LocalRecord.preview()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+this.state+"'). Call 'LocalRecorder.stop()' before");if(this.videoPreview=document.createElement("video"),this.videoPreview.id=this.id,this.videoPreview.autoplay=!0,"Safari"===o.name&&this.videoPreview.setAttribute("playsinline","true"),"string"==typeof e){var t=document.getElementById(e);t&&(this.videoPreview=t.appendChild(this.videoPreview))}else this.videoPreview=e.appendChild(this.videoPreview);return this.videoPreview.src=this.videoPreviewSrc,this.videoPreview},e.prototype.clean=function(){var e=this,t=function(){delete e.blob,e.chunks=[],delete e.mediaRecorder,e.state=i.LocalRecorderState.READY};this.state===i.LocalRecorderState.RECORDING||this.state===i.LocalRecorderState.PAUSED?this.stop().then((function(){return t()})).catch((function(){return t()})):t()},e.prototype.download=function(){if(this.state!==i.LocalRecorderState.FINISHED)throw Error("'LocalRecord.download()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+this.state+"'). Call 'LocalRecorder.stop()' before");var e=document.createElement("a");e.style.display="none",document.body.appendChild(e);var t=window.URL.createObjectURL(this.blob);e.href=t,e.download=this.id+".webm",e.click(),window.URL.revokeObjectURL(t),document.body.removeChild(e)},e.prototype.getBlob=function(){if(this.state!==i.LocalRecorderState.FINISHED)throw Error("Call 'LocalRecord.stop()' before getting Blob file");return this.blob},e.prototype.uploadAsBinary=function(e,t){var n=this;return new Promise((function(o,r){if(n.state!==i.LocalRecorderState.FINISHED)r(Error("'LocalRecord.uploadAsBinary()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+n.state+"'). Call 'LocalRecorder.stop()' before"));else{var s=new XMLHttpRequest;if(s.open("POST",e,!0),"object"==typeof t)for(var a=0,c=Object.keys(t);a<c.length;a++){var d=c[a];s.setRequestHeader(d,t[d])}s.onreadystatechange=function(){4===s.readyState&&("2"===s.status.toString().charAt(0)?o(s.responseText):r(s.status))},s.send(n.blob)}}))},e.prototype.uploadAsMultipartfile=function(e,t){var n=this;return new Promise((function(o,r){if(n.state!==i.LocalRecorderState.FINISHED)r(Error("'LocalRecord.uploadAsMultipartfile()' needs 'LocalRecord.state' to be 'FINISHED' (current value: '"+n.state+"'). Call 'LocalRecorder.stop()' before"));else{var s=new XMLHttpRequest;if(s.open("POST",e,!0),"object"==typeof t)for(var a=0,c=Object.keys(t);a<c.length;a++){var d=c[a];s.setRequestHeader(d,t[d])}var u=new FormData;u.append("file",n.blob,n.id+".webm"),s.onreadystatechange=function(){4===s.readyState&&("2"===s.status.toString().charAt(0)?o(s.responseText):r(s.status))},s.send(u)}}))},e.prototype.onStopDefault=function(){this.blob=new Blob(this.chunks,{type:"video/webm"}),this.chunks=[],this.videoPreviewSrc=window.URL.createObjectURL(this.blob),this.state=i.LocalRecorderState.FINISHED},e}();n.LocalRecorder=r},{"../OpenViduInternal/Enums/LocalRecorderState":27,platform:8}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("./LocalRecorder"),o=e("./Publisher"),r=e("./Session"),s=e("../OpenViduInternal/Events/StreamPropertyChangedEvent"),a=e("../OpenViduInternal/Enums/OpenViduError"),c=e("../OpenViduInternal/Enums/VideoInsertMode"),d=e("../OpenViduInternal/ScreenSharing/Screen-Capturing-Auto"),u=e("../OpenViduInternal/ScreenSharing/Screen-Capturing"),p=e("wolfy87-eventemitter"),l=e("../OpenViduInternal/KurentoUtils/kurento-jsonrpc"),f=e("platform");f.isIonicIos=("iPhone"===f.product||"iPad"===f.product)&&-1===f.ua.indexOf("Safari"),f.isIonicAndroid="Android"===f.os.family&&"Android Browser"==f.name;var h=e("../../package.json"),m=function(){function e(){var e=this;this.publishers=[],this.secret="",this.recorder=!1,this.advancedConfiguration={},this.webrtcStatsInterval=0,this.ee=new p,this.libraryVersion=h.version,"iOS"!==f.os.family&&"Android"!==f.os.family||window.addEventListener("orientationchange",(function(){e.publishers.forEach((function(t){if(t.stream.isLocalStreamPublished&&t.stream&&t.stream.hasVideo&&t.stream.streamManager.videos[0])var n=0,i=t.stream.videoDimensions.width,o=t.stream.videoDimensions.height,r=setInterval((function(){new Promise((function(e,n){if(f.isIonicIos)e({newWidth:t.stream.streamManager.videos[0].video.videoWidth,newHeight:t.stream.streamManager.videos[0].video.videoHeight});else{var i=t.stream.getMediaStream().getVideoTracks()[0].getSettings();e({newWidth:-1!==f.name.toLowerCase().indexOf("firefox")?i.width:t.videoReference.videoWidth,newHeight:-1!==f.name.toLowerCase().indexOf("firefox")?i.height:t.videoReference.videoHeight})}})).then((function(e){a(i,o,e.newWidth,e.newHeight)}))}),75),a=function(i,o,a,c){++n>10&&clearTimeout(r),a===i&&c===o||(t.stream.videoDimensions={width:a||0,height:c||0},e.sendRequest("streamPropertyChanged",{streamId:t.stream.streamId,property:"videoDimensions",newValue:JSON.stringify(t.stream.videoDimensions),reason:"deviceRotated"},(function(n,r){n||(e.session.emitEvent("streamPropertyChanged",[new s.StreamPropertyChangedEvent(e.session,t.stream,"videoDimensions",t.stream.videoDimensions,{width:i,height:o},"deviceRotated")]),t.emitEvent("streamPropertyChanged",[new s.StreamPropertyChangedEvent(t,t.stream,"videoDimensions",t.stream.videoDimensions,{width:i,height:o},"deviceRotated")]))})),clearTimeout(r))}}))}))}return e.prototype.initSession=function(){return this.session=new r.Session(this),this.session},e.prototype.initPublisher=function(e,t,n){var i;i=t&&"function"!=typeof t?{audioSource:void 0!==(i=t).audioSource?i.audioSource:void 0,frameRate:"undefined"!=typeof MediaStreamTrack&&i.videoSource instanceof MediaStreamTrack?void 0:void 0!==i.frameRate?i.frameRate:void 0,insertMode:void 0!==i.insertMode?"string"==typeof i.insertMode?c.VideoInsertMode[i.insertMode]:i.insertMode:c.VideoInsertMode.APPEND,mirror:void 0===i.mirror||i.mirror,publishAudio:void 0===i.publishAudio||i.publishAudio,publishVideo:void 0===i.publishVideo||i.publishVideo,resolution:"undefined"!=typeof MediaStreamTrack&&i.videoSource instanceof MediaStreamTrack?void 0:void 0!==i.resolution?i.resolution:"640x480",videoSource:void 0!==i.videoSource?i.videoSource:void 0,filter:i.filter}:{insertMode:c.VideoInsertMode.APPEND,mirror:!0,publishAudio:!0,publishVideo:!0,resolution:"640x480"};var r,s=new o.Publisher(e,i,this);return t&&"function"==typeof t?r=t:n&&(r=n),s.initialize().then((function(){void 0!==r&&r(void 0),s.emitEvent("accessAllowed",[])})).catch((function(e){void 0!==r&&r(e),s.emitEvent("accessDenied",[e])})),this.publishers.push(s),s},e.prototype.initPublisherAsync=function(e,t){var n=this;return new Promise((function(i,o){var r,s=function(e){e?o(e):i(r)};r=t?n.initPublisher(e,t,s):n.initPublisher(e,s)}))},e.prototype.initLocalRecorder=function(e){return new i.LocalRecorder(e)},e.prototype.checkSystemRequirements=function(){var e=f.name,t=f.os.family,n=f.ua?f.ua:navigator.userAgent;return"iOS"!==t||"Safari"===e&&-1===n.indexOf("CriOS")&&-1===n.indexOf("FxiOS")?"Safari"!==e&&"Chrome"!==e&&"Chrome Mobile"!==e&&"Firefox"!==e&&"Firefox Mobile"!==e&&"Opera"!==e&&"Opera Mobile"!==e&&"Android Browser"!==e&&"Electron"!==e?0:1:0},e.prototype.checkScreenSharingCapabilities=function(){var e=f.name,t=f.os.family;return"iOS"===t||"Android"===t||"Chrome"!==e&&"Firefox"!==e&&"Opera"!==e&&"Electron"!==e?0:1},e.prototype.getDevices=function(){return new Promise((function(e,t){navigator.mediaDevices.enumerateDevices().then((function(t){var n=[];f.isIonicAndroid&&cordova.plugins&&cordova.plugins.EnumerateDevicesPlugin?cordova.plugins.EnumerateDevicesPlugin.getEnumerateDevices().then((function(i){var o=[],r=[],s=[];o=i.filter((function(e){return"audioinput"===e.kind})),r=t.filter((function(e){return"videoinput"===e.kind})),s=t.filter((function(e){return"audioinput"===e.kind})),r.forEach((function(e,t){var i;e.label?n.push({kind:e.kind,deviceId:e.deviceId,label:e.label}):(i=0===t?"Front Camera":1===t?"Back Camera":"Unknown Camera",n.push({kind:e.kind,deviceId:e.deviceId,label:i}))})),s.forEach((function(e,t){if(e.label)n.push({kind:e.kind,deviceId:e.deviceId,label:e.label});else{var i="";switch(t){case 0:i="Default";break;case 1:var r=o.filter((function(e){return e.label.includes("Built")}))[0];i=r?r.label:"Built-in Microphone";break;case 2:var s=o.filter((function(e){return e.label.includes("Wired")}))[0];i=s?s.label:"Headset earpiece";break;case 3:var a=o.filter((function(e){return e.label.includes("Bluetooth")}))[0];i=a?a.label:"Wireless";break;default:i="Unknown Microphone"}n.push({kind:e.kind,deviceId:e.deviceId,label:i})}})),e(n)})):(t.forEach((function(e){"audioinput"!==e.kind&&"videoinput"!==e.kind||n.push({kind:e.kind,deviceId:e.deviceId,label:e.label})})),e(n))})).catch((function(e){t(e)}))}))},e.prototype.getUserMedia=function(e){var t=this;return new Promise((function(n,i){t.generateMediaConstraints(e).then((function(t){navigator.mediaDevices.getUserMedia(t).then((function(e){n(e)})).catch((function(t){var n,o=t.toString();n="screen"!==e.videoSource?a.OpenViduErrorName.DEVICE_ACCESS_DENIED:a.OpenViduErrorName.SCREEN_CAPTURE_DENIED,i(new a.OpenViduError(n,o))}))})).catch((function(e){i(e)}))}))},e.prototype.enableProdMode=function(){console.log=function(){},console.debug=function(){},console.info=function(){},console.warn=function(){}},e.prototype.setAdvancedConfiguration=function(e){this.advancedConfiguration=e},e.prototype.generateMediaConstraints=function(e){var t=this;return new Promise((function(n,i){var o={audio:null!==e.audioSource&&!1!==e.audioSource&&(void 0===e.audioSource||e.audioSource),video:null!==e.videoSource&&!1!==e.videoSource&&{height:{ideal:480},width:{ideal:640}}};if("string"==typeof o.audio&&(o.audio={deviceId:{exact:o.audio}}),o.video){if(e.resolution){var r=e.resolution.toLowerCase().split("x"),s=Number(r[0]),c=Number(r[1]);o.video.width.ideal=s,o.video.height.ideal=c}if(e.frameRate&&(o.video.frameRate={ideal:e.frameRate}),e.videoSource&&"string"==typeof e.videoSource)if("screen"===e.videoSource||-1!==f.name.indexOf("Firefox")&&"window"===e.videoSource||"Electron"===f.name&&e.videoSource.startsWith("screen:"))if(t.checkScreenSharingCapabilities())if("Electron"===f.name){var p="screen:",l=e.videoSource,h=l.substr(l.indexOf(p)+p.length);o.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:h}},n(o)}else{if(t.advancedConfiguration.screenShareChromeExtension&&-1===f.name.indexOf("Firefox")&&!navigator.mediaDevices.getDisplayMedia)u.getScreenConstraints((function(e,r){if(e||r.mandatory&&"screen"===r.mandatory.chromeMediaSource)if("permission-denied"===e||"PermissionDeniedError"===e){var s=new a.OpenViduError(a.OpenViduErrorName.SCREEN_CAPTURE_DENIED,"You must allow access to one window of your desktop");i(s)}else{var c=t.advancedConfiguration.screenShareChromeExtension.split("/").pop().trim();u.getChromeExtensionStatus(c,(function(e){if("installed-disabled"===e){var n=new a.OpenViduError(a.OpenViduErrorName.SCREEN_EXTENSION_DISABLED,"You must enable the screen extension");i(n)}if("not-installed"===e){var o=new a.OpenViduError(a.OpenViduErrorName.SCREEN_EXTENSION_NOT_INSTALLED,t.advancedConfiguration.screenShareChromeExtension);i(o)}}))}else o.video=r,n(o)}));else if(navigator.mediaDevices.getDisplayMedia)n(o);else{var m=-1!==f.name.indexOf("Firefox")?e.videoSource:void 0;d.getScreenId(m,(function(e,r,s){if(e){if("not-installed"===e){var c=t.advancedConfiguration.screenShareChromeExtension?t.advancedConfiguration.screenShareChromeExtension:"https://chrome.google.com/webstore/detail/openvidu-screensharing/lfcgfepafnobdloecchnfaclibenjold",d=new a.OpenViduError(a.OpenViduErrorName.SCREEN_EXTENSION_NOT_INSTALLED,c);i(d)}else if("installed-disabled"===e){var u=new a.OpenViduError(a.OpenViduErrorName.SCREEN_EXTENSION_DISABLED,"You must enable the screen extension");i(u)}else if("permission-denied"===e){var p=new a.OpenViduError(a.OpenViduErrorName.SCREEN_CAPTURE_DENIED,"You must allow access to one window of your desktop");i(p)}}else o.video=s.video,n(o)}))}e.videoSource="screen"}else{var v=new a.OpenViduError(a.OpenViduErrorName.SCREEN_SHARING_NOT_SUPPORTED,"You can only screen share in desktop Chrome, Firefox, Opera or Electron. Detected client: "+f.name);i(v)}else o.video.deviceId={exact:e.videoSource},n(o);else n(o)}else n(o)}))},e.prototype.startWs=function(e){var t={heartbeat:5e3,sendCloseMessage:!1,ws:{uri:this.wsUri,useSockJS:!1,onconnected:e,ondisconnect:this.disconnectCallback.bind(this),onreconnecting:this.reconnectingCallback.bind(this),onreconnected:this.reconnectedCallback.bind(this)},rpc:{requestTimeout:1e4,participantJoined:this.session.onParticipantJoined.bind(this.session),participantPublished:this.session.onParticipantPublished.bind(this.session),participantUnpublished:this.session.onParticipantUnpublished.bind(this.session),participantLeft:this.session.onParticipantLeft.bind(this.session),participantEvicted:this.session.onParticipantEvicted.bind(this.session),recordingStarted:this.session.onRecordingStarted.bind(this.session),recordingStopped:this.session.onRecordingStopped.bind(this.session),sendMessage:this.session.onNewMessage.bind(this.session),streamPropertyChanged:this.session.onStreamPropertyChanged.bind(this.session),filterEventDispatched:this.session.onFilterEventDispatched.bind(this.session),iceCandidate:this.session.recvIceCandidate.bind(this.session),mediaError:this.session.onMediaError.bind(this.session)}};this.jsonRpcClient=new l.clients.JsonRpcClient(t)},e.prototype.closeWs=function(){this.jsonRpcClient.close(4102,"Connection closed by client")},e.prototype.sendRequest=function(e,t,n){t&&t instanceof Function&&(n=t,t={}),this.jsonRpcClient.send(e,t,n)},e.prototype.getWsUri=function(){return this.wsUri},e.prototype.getSecret=function(){return this.secret},e.prototype.getRecorder=function(){return this.recorder},e.prototype.disconnectCallback=function(){this.isRoomAvailable()?this.session.onLostConnection("networkDisconnect"):alert("Connection error. Please reload page.")},e.prototype.reconnectingCallback=function(){this.isRoomAvailable()||alert("Connection error. Please reload page.")},e.prototype.reconnectedCallback=function(){var e=this;this.isRoomAvailable()?this.sendRequest("connect",{sessionId:this.session.connection.rpcSessionId},(function(t,n){t?(e.session.onLostConnection("networkDisconnect"),e.jsonRpcClient.close(4101,"Reconnection fault")):(e.jsonRpcClient.resetPing(),e.session.onRecoveredConnection())})):alert("Connection error. Please reload page.")},e.prototype.isRoomAvailable=function(){return void 0!==this.session&&this.session instanceof r.Session||!1},e}();n.OpenVidu=m},{"../../package.json":16,"../OpenViduInternal/Enums/OpenViduError":28,"../OpenViduInternal/Enums/VideoInsertMode":29,"../OpenViduInternal/Events/StreamPropertyChangedEvent":39,"../OpenViduInternal/KurentoUtils/kurento-jsonrpc":46,"../OpenViduInternal/ScreenSharing/Screen-Capturing":51,"../OpenViduInternal/ScreenSharing/Screen-Capturing-Auto":50,"./LocalRecorder":20,"./Publisher":22,"./Session":23,platform:8,"wolfy87-eventemitter":15}],22:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var r=e("./Session"),s=e("./Stream"),a=e("./StreamManager"),c=e("../OpenViduInternal/Events/StreamEvent"),d=e("../OpenViduInternal/Events/StreamPropertyChangedEvent"),u=e("../OpenViduInternal/Events/VideoElementEvent"),p=e("../OpenViduInternal/Enums/OpenViduError"),l=e("platform"),f=function(e){function t(t,n,i){var o=e.call(this,new s.Stream(i.session?i.session:new r.Session(i),{publisherProperties:n,mediaConstraints:{}}),t)||this;return o.accessAllowed=!1,o.isSubscribedToRemote=!1,o.accessDenied=!1,o.properties=n,o.openvidu=i,o.stream.ee.on("local-stream-destroyed",(function(e){o.stream.isLocalStreamPublished=!1;var t=new c.StreamEvent(!0,o,"streamDestroyed",o.stream,e);o.emitEvent("streamDestroyed",[t]),t.callDefaultBehavior()})),o}return o(t,e),t.prototype.publishAudio=function(e){var t=this;this.stream.audioActive!==e&&(this.stream.getMediaStream().getAudioTracks().forEach((function(t){t.enabled=e})),this.session&&this.stream.streamId&&this.session.openvidu.sendRequest("streamPropertyChanged",{streamId:this.stream.streamId,property:"audioActive",newValue:e,reason:"publishAudio"},(function(n,i){n||(t.session.emitEvent("streamPropertyChanged",[new d.StreamPropertyChangedEvent(t.session,t.stream,"audioActive",e,!e,"publishAudio")]),t.emitEvent("streamPropertyChanged",[new d.StreamPropertyChangedEvent(t,t.stream,"audioActive",e,!e,"publishAudio")]))})),this.stream.audioActive=e)},t.prototype.publishVideo=function(e){var t=this;this.stream.videoActive!==e&&(this.stream.getMediaStream().getVideoTracks().forEach((function(t){t.enabled=e})),this.session&&this.stream.streamId&&this.session.openvidu.sendRequest("streamPropertyChanged",{streamId:this.stream.streamId,property:"videoActive",newValue:e,reason:"publishVideo"},(function(n,i){n||(t.session.emitEvent("streamPropertyChanged",[new d.StreamPropertyChangedEvent(t.session,t.stream,"videoActive",e,!e,"publishVideo")]),t.emitEvent("streamPropertyChanged",[new d.StreamPropertyChangedEvent(t,t.stream,"videoActive",e,!e,"publishVideo")]))})),this.stream.videoActive=e)},t.prototype.subscribeToRemote=function(e){e=void 0===e||e,this.isSubscribedToRemote=e,this.stream.subscribeToMyRemote(e)},t.prototype.on=function(t,n){var i=this;return e.prototype.on.call(this,t,n),"streamCreated"===t&&(this.stream&&this.stream.isLocalStreamPublished?this.emitEvent("streamCreated",[new c.StreamEvent(!1,this,"streamCreated",this.stream,"")]):this.stream.ee.on("stream-created-by-publisher",(function(){i.emitEvent("streamCreated",[new c.StreamEvent(!1,i,"streamCreated",i.stream,"")])}))),"remoteVideoPlaying"===t&&this.stream.displayMyRemote()&&this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&!1===this.videos[0].video.paused&&!1===this.videos[0].video.ended&&4===this.videos[0].video.readyState&&this.emitEvent("remoteVideoPlaying",[new u.VideoElementEvent(this.videos[0].video,this,"remoteVideoPlaying")]),"accessAllowed"===t&&this.accessAllowed&&this.emitEvent("accessAllowed",[]),"accessDenied"===t&&this.accessDenied&&this.emitEvent("accessDenied",[]),this},t.prototype.once=function(t,n){var i=this;return e.prototype.once.call(this,t,n),"streamCreated"===t&&(this.stream&&this.stream.isLocalStreamPublished?this.emitEvent("streamCreated",[new c.StreamEvent(!1,this,"streamCreated",this.stream,"")]):this.stream.ee.once("stream-created-by-publisher",(function(){i.emitEvent("streamCreated",[new c.StreamEvent(!1,i,"streamCreated",i.stream,"")])}))),"remoteVideoPlaying"===t&&this.stream.displayMyRemote()&&this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&!1===this.videos[0].video.paused&&!1===this.videos[0].video.ended&&4===this.videos[0].video.readyState&&this.emitEvent("remoteVideoPlaying",[new u.VideoElementEvent(this.videos[0].video,this,"remoteVideoPlaying")]),"accessAllowed"===t&&this.accessAllowed&&this.emitEvent("accessAllowed",[]),"accessDenied"===t&&this.accessDenied&&this.emitEvent("accessDenied",[]),this},t.prototype.initialize=function(){var e=this;return new Promise((function(t,n){var i,o={},r={},s=1250,a=function(t){e.accessDenied=!0,e.accessAllowed=!1,n(t)},c=function(n){if(e.accessAllowed=!0,e.accessDenied=!1,"undefined"!=typeof MediaStreamTrack&&e.properties.audioSource instanceof MediaStreamTrack&&(n.removeTrack(n.getAudioTracks()[0]),n.addTrack(e.properties.audioSource)),"undefined"!=typeof MediaStreamTrack&&e.properties.videoSource instanceof MediaStreamTrack&&(n.removeTrack(n.getVideoTracks()[0]),n.addTrack(e.properties.videoSource)),n.getAudioTracks()[0]){var i=void 0!==e.stream.audioActive&&null!==e.stream.audioActive?e.stream.audioActive:!!e.stream.outboundStreamOpts.publisherProperties.publishAudio;n.getAudioTracks()[0].enabled=i}if(n.getVideoTracks()[0]&&(i=void 0!==e.stream.videoActive&&null!==e.stream.videoActive?e.stream.videoActive:!!e.stream.outboundStreamOpts.publisherProperties.publishVideo,n.getVideoTracks()[0].enabled=i),e.videoReference=document.createElement("video"),"Safari"===l.name&&e.videoReference.setAttribute("playsinline","true"),e.stream.setMediaStream(n),e.firstVideoElement&&e.createVideoElement(e.firstVideoElement.targetElement,e.properties.insertMode),e.videoReference.srcObject=n,e.stream.displayMyRemote()||e.stream.updateMediaStreamInVideos(),delete e.firstVideoElement,e.stream.isSendVideo())if(e.stream.isSendScreen())e.videoReference.addEventListener("loadedmetadata",(function(){e.stream.videoDimensions={width:e.videoReference.videoWidth,height:e.videoReference.videoHeight},e.screenShareResizeInterval=setInterval((function(){var t=n.getVideoTracks()[0].getSettings(),i="Chrome"===l.name||"Opera"===l.name?e.videoReference.videoWidth:t.width,o="Chrome"===l.name||"Opera"===l.name?e.videoReference.videoHeight:t.height;if(e.stream.isLocalStreamPublished&&(i!==e.stream.videoDimensions.width||o!==e.stream.videoDimensions.height)){var r={width:e.stream.videoDimensions.width,height:e.stream.videoDimensions.height};e.stream.videoDimensions={width:i||0,height:o||0},e.session.openvidu.sendRequest("streamPropertyChanged",{streamId:e.stream.streamId,property:"videoDimensions",newValue:JSON.stringify(e.stream.videoDimensions),reason:"screenResized"},(function(t,n){t||(e.session.emitEvent("streamPropertyChanged",[new d.StreamPropertyChangedEvent(e.session,e.stream,"videoDimensions",e.stream.videoDimensions,r,"screenResized")]),e.emitEvent("streamPropertyChanged",[new d.StreamPropertyChangedEvent(e,e.stream,"videoDimensions",e.stream.videoDimensions,r,"screenResized")]))}))}}),500),e.stream.isLocalStreamReadyToPublish=!0,e.stream.ee.emitEvent("stream-ready-to-publish",[])}));else if(l.isIonicIos||"Safari"===l.name){e.videoReference.style.display="none",document.body.appendChild(e.videoReference);var o,r=function(){e.stream.videoDimensions={width:e.videoReference.videoWidth,height:e.videoReference.videoHeight},e.stream.isLocalStreamReadyToPublish=!0,e.stream.ee.emitEvent("stream-ready-to-publish",[]),document.body.removeChild(e.videoReference)};e.videoReference.addEventListener("loadedmetadata",(function(){0===e.videoReference.videoWidth?o=setInterval((function(){0!==e.videoReference.videoWidth&&(clearInterval(o),r())}),40):r()}))}else{var s=n.getVideoTracks()[0].getSettings(),a=s.width,c=s.height;("iOS"===l.os.family||"Android"===l.os.family)&&window.innerHeight>window.innerWidth?e.stream.videoDimensions={width:c||0,height:a||0}:e.stream.videoDimensions={width:a||0,height:c||0},e.stream.isLocalStreamReadyToPublish=!0,e.stream.ee.emitEvent("stream-ready-to-publish",[])}else e.stream.isLocalStreamReadyToPublish=!0,e.stream.ee.emitEvent("stream-ready-to-publish",[]);t()},u=function(t,n){e.clearPermissionDialogTimer(i,s),e.stream.isSendScreen()&&e.stream.isSendAudio()?(r.audio=n,r.video=!1,i=Date.now(),e.setPermissionDialogTimer(s),navigator.mediaDevices.getUserMedia(r).then((function(n){e.clearPermissionDialogTimer(i,s),t.addTrack(n.getAudioTracks()[0]),c(t)})).catch((function(t){var n,r;switch(e.clearPermissionDialogTimer(i,s),"Error"===t.name&&(t.name=t.constructor.name),t.name.toLowerCase()){case"notfounderror":n=p.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,r=t.toString(),a(new p.OpenViduError(n,r));break;case"notallowederror":n=p.OpenViduErrorName.DEVICE_ACCESS_DENIED,r=t.toString(),a(new p.OpenViduError(n,r));break;case"overconstrainederror":"deviceid"===t.constraint.toLowerCase()?(n=p.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,r="Audio input device with deviceId '"+o.video.deviceId.exact+"' not found"):(n=p.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,r="Audio input device doesn't support the value passed for constraint '"+t.constraint+"'"),a(new p.OpenViduError(n,r))}}))):c(t)},f=function(t){var n,r;switch(e.clearPermissionDialogTimer(i,s),"Error"===t.name&&(t.name=t.constructor.name),t.name.toLowerCase()){case"notfounderror":navigator.mediaDevices.getUserMedia({audio:!1,video:o.video}).then((function(e){e.getVideoTracks().forEach((function(e){e.stop()})),n=p.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,r=t.toString(),a(new p.OpenViduError(n,r))})).catch((function(e){n=p.OpenViduErrorName.INPUT_VIDEO_DEVICE_NOT_FOUND,r=t.toString(),a(new p.OpenViduError(n,r))}));break;case"notallowederror":n=e.stream.isSendScreen()?p.OpenViduErrorName.SCREEN_CAPTURE_DENIED:p.OpenViduErrorName.DEVICE_ACCESS_DENIED,r=t.toString(),a(new p.OpenViduError(n,r));break;case"overconstrainederror":navigator.mediaDevices.getUserMedia({audio:!1,video:o.video}).then((function(e){e.getVideoTracks().forEach((function(e){e.stop()})),"deviceid"===t.constraint.toLowerCase()?(n=p.OpenViduErrorName.INPUT_AUDIO_DEVICE_NOT_FOUND,r="Audio input device with deviceId '"+o.audio.deviceId.exact+"' not found"):(n=p.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,r="Audio input device doesn't support the value passed for constraint '"+t.constraint+"'"),a(new p.OpenViduError(n,r))})).catch((function(e){"deviceid"===t.constraint.toLowerCase()?(n=p.OpenViduErrorName.INPUT_VIDEO_DEVICE_NOT_FOUND,r="Video input device with deviceId '"+o.video.deviceId.exact+"' not found"):(n=p.OpenViduErrorName.PUBLISHER_PROPERTIES_ERROR,r="Video input device doesn't support the value passed for constraint '"+t.constraint+"'"),a(new p.OpenViduError(n,r))}));break;case"aborterror":case"notreadableerror":n=p.OpenViduErrorName.DEVICE_ALREADY_IN_USE,r=t.toString(),a(new p.OpenViduError(n,r));break;default:n=p.OpenViduErrorName.GENERIC_ERROR,r=t.toString(),a(new p.OpenViduError(n,r))}};if("undefined"!=typeof MediaStreamTrack&&e.properties.videoSource instanceof MediaStreamTrack&&!e.properties.audioSource||"undefined"!=typeof MediaStreamTrack&&e.properties.audioSource instanceof MediaStreamTrack&&!e.properties.videoSource||"undefined"!=typeof MediaStreamTrack&&e.properties.videoSource instanceof MediaStreamTrack&&e.properties.audioSource instanceof MediaStreamTrack){var h=new MediaStream;return"undefined"!=typeof MediaStreamTrack&&e.properties.videoSource instanceof MediaStreamTrack&&h.addTrack(e.properties.videoSource),"undefined"!=typeof MediaStreamTrack&&e.properties.audioSource instanceof MediaStreamTrack&&h.addTrack(e.properties.audioSource),void c(h)}e.openvidu.generateMediaConstraints(e.properties).then((function(t){var a={mediaConstraints:o=t,publisherProperties:e.properties};if(e.stream.setOutboundStreamOptions(a),e.stream.isSendVideo()||e.stream.isSendAudio()){var c=void 0===o.audio||o.audio;r.audio=!e.stream.isSendScreen()&&c,r.video=o.video,i=Date.now(),e.setPermissionDialogTimer(s),e.stream.isSendScreen()&&navigator.mediaDevices.getDisplayMedia&&"Electron"!==l.name?navigator.mediaDevices.getDisplayMedia({video:!0}).then((function(e){u(e,c)})).catch((function(e){f(e)})):navigator.mediaDevices.getUserMedia(r).then((function(e){u(e,c)})).catch((function(e){f(e)}))}else n(new p.OpenViduError(p.OpenViduErrorName.NO_INPUT_SOURCE_SET,"Properties 'audioSource' and 'videoSource' cannot be set to false or null at the same time when calling 'OpenVidu.initPublisher'"))})).catch((function(e){a(e)}))}))},t.prototype.reestablishStreamPlayingEvent=function(){this.ee.getListeners("streamPlaying").length>0&&this.addPlayEventToFirstVideo()},t.prototype.setPermissionDialogTimer=function(e){var t=this;this.permissionDialogTimeout=setTimeout((function(){t.emitEvent("accessDialogOpened",[])}),e)},t.prototype.clearPermissionDialogTimer=function(e,t){clearTimeout(this.permissionDialogTimeout),Date.now()-e>t&&this.emitEvent("accessDialogClosed",[])},t}(a.StreamManager);n.Publisher=f},{"../OpenViduInternal/Enums/OpenViduError":28,"../OpenViduInternal/Events/StreamEvent":37,"../OpenViduInternal/Events/StreamPropertyChangedEvent":39,"../OpenViduInternal/Events/VideoElementEvent":40,"./Session":23,"./Stream":24,"./StreamManager":25,platform:8}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("./Connection"),o=e("./Filter"),r=e("./Subscriber"),s=e("../OpenViduInternal/Events/ConnectionEvent"),a=e("../OpenViduInternal/Events/FilterEvent"),c=e("../OpenViduInternal/Events/RecordingEvent"),d=e("../OpenViduInternal/Events/SessionDisconnectedEvent"),u=e("../OpenViduInternal/Events/SignalEvent"),p=e("../OpenViduInternal/Events/StreamEvent"),l=e("../OpenViduInternal/Events/StreamPropertyChangedEvent"),f=e("../OpenViduInternal/Enums/OpenViduError"),h=e("../OpenViduInternal/Enums/VideoInsertMode"),m=e("wolfy87-eventemitter"),v=e("platform"),b=function(){function e(e){this.streamManagers=[],this.remoteStreamsCreated={},this.isFirstIonicIosSubscriber=!0,this.countDownForIonicIosSubscribersActive=!0,this.remoteConnections={},this.speakingEventsEnabled=!1,this.ee=new m,this.openvidu=e}return e.prototype.connect=function(e,t){var n=this;return new Promise((function(i,o){n.processToken(e),n.openvidu.checkSystemRequirements()?(n.options={sessionId:n.sessionId,participantId:e,metadata:t?n.stringClientMetadata(t):""},n.connectAux(e).then((function(){i()})).catch((function(e){o(e)}))):o(new f.OpenViduError(f.OpenViduErrorName.BROWSER_NOT_SUPPORTED,"Browser "+v.name+" (version "+v.version+") for "+v.os.family+" is not supported in OpenVidu"))}))},e.prototype.disconnect=function(){this.leave(!1,"disconnect")},e.prototype.subscribe=function(e,t,n,i){var o,s={};s=n&&"function"!=typeof n?{insertMode:void 0!==n.insertMode?"string"==typeof n.insertMode?h.VideoInsertMode[n.insertMode]:s.insertMode:h.VideoInsertMode.APPEND,subscribeToAudio:void 0===n.subscribeToAudio||n.subscribeToAudio,subscribeToVideo:void 0===n.subscribeToVideo||n.subscribeToVideo}:{insertMode:h.VideoInsertMode.APPEND,subscribeToAudio:!0,subscribeToVideo:!0},n&&"function"==typeof n?o=n:i&&(o=i),e.subscribe().then((function(){void 0!==o&&o(void 0)})).catch((function(e){void 0!==o&&o(e)}));var a=new r.Subscriber(e,t,s);return a.targetElement&&e.streamManager.createVideoElement(a.targetElement,s.insertMode),a},e.prototype.subscribeAsync=function(e,t,n){var i=this;return new Promise((function(o,r){var s,a=function(e){e?r(e):o(s)};s=n?i.subscribe(e,t,n,a):i.subscribe(e,t,a)}))},e.prototype.unsubscribe=function(e){e.stream.connection.connectionId,this.openvidu.sendRequest("unsubscribeFromVideo",{sender:e.stream.connection.connectionId},(function(t,n){e.stream.disposeWebRtcPeer(),e.stream.disposeMediaStream()})),e.stream.streamManager.removeAllVideos()},e.prototype.publish=function(e){var t=this;return new Promise((function(n,i){e.session=t,e.stream.session=t,e.stream.publishedOnce?e.initialize().then((function(){t.connection.addStream(e.stream),e.reestablishStreamPlayingEvent(),e.stream.publish().then((function(){n()})).catch((function(e){i(e)}))})).catch((function(e){i(e)})):(t.connection.addStream(e.stream),e.stream.publish().then((function(){n()})).catch((function(e){i(e)})))}))},e.prototype.unpublish=function(e){var t=e.stream;if(t.connection&&t.connection===this.connection){this.openvidu.sendRequest("unpublishVideo",(function(e,t){})),t.disposeWebRtcPeer(),delete t.connection.stream;var n=new p.StreamEvent(!0,e,"streamDestroyed",e.stream,"unpublish");e.emitEvent("streamDestroyed",[n]),n.callDefaultBehavior()}},e.prototype.forceDisconnect=function(e){var t=this;return new Promise((function(n,i){t.openvidu.sendRequest("forceDisconnect",{connectionId:e.connectionId},(function(e,t){e?401===e.code?i(new f.OpenViduError(f.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to force a disconnection")):i(e):n()}))}))},e.prototype.forceUnpublish=function(e){var t=this;return new Promise((function(n,i){t.openvidu.sendRequest("forceUnpublish",{streamId:e.streamId},(function(e,t){e?401===e.code?i(new f.OpenViduError(f.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to force an unpublishing")):i(e):n()}))}))},e.prototype.signal=function(e){var t=this;return new Promise((function(n,i){var o={};if(e.to&&e.to.length>0){var r=[];e.to.forEach((function(e){r.push(e.connectionId)})),o.to=r}else o.to=[];o.data=e.data?e.data:"";var s=e.type?e.type:"signal";s&&"signal:"!==s.substring(0,7)&&(s="signal:"+s),o.type=s,t.openvidu.sendRequest("sendMessage",{message:JSON.stringify(o)},(function(e,t){e?i(e):n()}))}))},e.prototype.on=function(e,t){if(this.ee.on(e,(function(e){t(e)})),"publisherStartSpeaking"===e||"publisherStopSpeaking"===e)for(var n in this.speakingEventsEnabled=!0,this.remoteConnections){var i=this.remoteConnections[n].stream;i&&i.hasAudio&&i.enableSpeakingEvents()}return this},e.prototype.once=function(e,t){if(this.ee.once(e,(function(e){t(e)})),"publisherStartSpeaking"===e||"publisherStopSpeaking"===e)for(var n in this.speakingEventsEnabled=!0,this.remoteConnections){var i=this.remoteConnections[n].stream;i&&i.hasAudio&&i.enableOnceSpeakingEvents()}return this},e.prototype.off=function(e,t){if(t?this.ee.off(e,t):this.ee.removeAllListeners(e),"publisherStartSpeaking"===e||"publisherStopSpeaking"===e)for(var n in this.speakingEventsEnabled=!1,this.remoteConnections){var i=this.remoteConnections[n].stream;i&&i.disableSpeakingEvents()}return this},e.prototype.onParticipantJoined=function(e){var t=this;this.getConnection(e.id,"").then((function(e){})).catch((function(n){var o=new i.Connection(t,e);t.remoteConnections[e.id]=o,t.ee.emitEvent("connectionCreated",[new s.ConnectionEvent(!1,t,"connectionCreated",o,"")])}))},e.prototype.onParticipantLeft=function(e){var t=this;this.getRemoteConnection(e.connectionId,"Remote connection "+e.connectionId+" unknown when 'onParticipantLeft'. Existing remote connections: "+JSON.stringify(Object.keys(this.remoteConnections))).then((function(n){if(n.stream){var i=n.stream,o=new p.StreamEvent(!0,t,"streamDestroyed",i,e.reason);t.ee.emitEvent("streamDestroyed",[o]),o.callDefaultBehavior(),delete t.remoteStreamsCreated[i.streamId],0===Object.keys(t.remoteStreamsCreated).length&&(t.isFirstIonicIosSubscriber=!0,t.countDownForIonicIosSubscribersActive=!0)}delete t.remoteConnections[n.connectionId],t.ee.emitEvent("connectionDestroyed",[new s.ConnectionEvent(!1,t,"connectionDestroyed",n,e.reason)])})).catch((function(e){}))},e.prototype.onParticipantPublished=function(e){var t,n=this,o=function(e){n.remoteConnections[e.connectionId]=e,n.remoteStreamsCreated[e.stream.streamId]||n.ee.emitEvent("streamCreated",[new p.StreamEvent(!1,n,"streamCreated",e.stream,"")]),n.remoteStreamsCreated[e.stream.streamId]=!0};this.getRemoteConnection(e.id,"Remote connection '"+e.id+"' unknown when 'onParticipantPublished'. Existing remote connections: "+JSON.stringify(Object.keys(this.remoteConnections))).then((function(n){t=n,e.metadata=n.data,t.options=e,t.initRemoteStreams(e.streams),o(t)})).catch((function(r){t=new i.Connection(n,e),o(t)}))},e.prototype.onParticipantUnpublished=function(e){var t=this;e.connectionId===this.connection.connectionId?this.stopPublisherStream(e.reason):this.getRemoteConnection(e.connectionId,"Remote connection '"+e.connectionId+"' unknown when 'onParticipantUnpublished'. Existing remote connections: "+JSON.stringify(Object.keys(this.remoteConnections))).then((function(n){var i=new p.StreamEvent(!0,t,"streamDestroyed",n.stream,e.reason);t.ee.emitEvent("streamDestroyed",[i]),i.callDefaultBehavior();var o=n.stream.streamId;delete t.remoteStreamsCreated[o],0===Object.keys(t.remoteStreamsCreated).length&&(t.isFirstIonicIosSubscriber=!0,t.countDownForIonicIosSubscribersActive=!0),n.removeStream(o)})).catch((function(e){}))},e.prototype.onParticipantEvicted=function(e){e.connectionId===this.connection.connectionId&&this.sessionId&&!this.connection.disposed&&this.leave(!0,e.reason)},e.prototype.onNewMessage=function(e){var t=this;this.getConnection(e.from,"Connection '"+e.from+"' unknow when 'onNewMessage'. Existing remote connections: "+JSON.stringify(Object.keys(this.remoteConnections))+". Existing local connection: "+this.connection.connectionId).then((function(n){t.ee.emitEvent("signal",[new u.SignalEvent(t,e.type,e.data,n)]),"signal"!==e.type&&t.ee.emitEvent(e.type,[new u.SignalEvent(t,e.type,e.data,n)])})).catch((function(e){}))},e.prototype.onStreamPropertyChanged=function(e){var t=this,n=function(n){if(n.stream&&n.stream.streamId===e.streamId){var i=n.stream,r=void 0;switch(e.property){case"audioActive":r=i.audioActive,e.newValue="true"===e.newValue,i.audioActive=e.newValue;break;case"videoActive":r=i.videoActive,e.newValue="true"===e.newValue,i.videoActive=e.newValue;break;case"videoDimensions":r=i.videoDimensions,e.newValue=JSON.parse(JSON.parse(e.newValue)),i.videoDimensions=e.newValue;break;case"filter":r=i.filter,e.newValue=Object.keys(e.newValue).length>0?e.newValue:void 0,void 0!==e.newValue?(i.filter=new o.Filter(e.newValue.type,e.newValue.options),i.filter.stream=i,e.newValue.lastExecMethod&&(i.filter.lastExecMethod=e.newValue.lastExecMethod)):delete i.filter,e.newValue=i.filter}t.ee.emitEvent("streamPropertyChanged",[new l.StreamPropertyChangedEvent(t,i,e.property,e.newValue,r,e.reason)]),i.streamManager&&i.streamManager.emitEvent("streamPropertyChanged",[new l.StreamPropertyChangedEvent(i.streamManager,i,e.property,e.newValue,r,e.reason)])}};e.connectionId===this.connection.connectionId?n(this.connection):this.getRemoteConnection(e.connectionId,"Remote connection "+e.connectionId+" unknown when 'onStreamPropertyChanged'. Existing remote connections: "+JSON.stringify(Object.keys(this.remoteConnections))).then((function(e){n(e)})).catch((function(e){}))},e.prototype.recvIceCandidate=function(e){var t={candidate:e.candidate,component:e.component,foundation:e.foundation,ip:e.ip,port:e.port,priority:e.priority,protocol:e.protocol,relatedAddress:e.relatedAddress,relatedPort:e.relatedPort,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex,tcpType:e.tcpType,usernameFragment:e.usernameFragment,type:e.type,toJSON:function(){return{candidate:e.candidate}}};this.getConnection(e.senderConnectionId,"Connection not found for connectionId "+e.senderConnectionId+" owning endpoint "+e.endpointName+". Ice candidate will be ignored: "+t).then((function(e){e.stream.getWebRtcPeer().addIceCandidate(t).catch((function(e){}))})).catch((function(e){}))},e.prototype.onSessionClosed=function(e){var t=e.sessionId;void 0!==t&&this.ee.emitEvent("session-closed",[{session:t}])},e.prototype.onLostConnection=function(e){this.sessionId&&!this.connection.disposed&&this.leave(!0,e)},e.prototype.onRecoveredConnection=function(){},e.prototype.onMediaError=function(e){var t=e.error;t&&this.ee.emitEvent("error-media",[{error:t}])},e.prototype.onRecordingStarted=function(e){this.ee.emitEvent("recordingStarted",[new c.RecordingEvent(this,"recordingStarted",e.id,e.name)])},e.prototype.onRecordingStopped=function(e){this.ee.emitEvent("recordingStopped",[new c.RecordingEvent(this,"recordingStopped",e.id,e.name,e.reason)])},e.prototype.onFilterEventDispatched=function(e){var t=e.connectionId;e.streamId,this.getConnection(t,"No connection found for connectionId "+t).then((function(t){var n=t.stream;n.filter.handlers[e.eventType](new a.FilterEvent(n.filter,e.eventType,e.data))}))},e.prototype.emitEvent=function(e,t){this.ee.emitEvent(e,t)},e.prototype.leave=function(e,t){var n=this;if(e=!!e,this.connection&&(this.connection.disposed||e?this.openvidu.closeWs():this.openvidu.sendRequest("leaveRoom",(function(e,t){n.openvidu.closeWs()})),this.stopPublisherStream(t),!this.connection.disposed)){var i=new d.SessionDisconnectedEvent(this,t);this.ee.emitEvent("sessionDisconnected",[i]),i.callDefaultBehavior()}},e.prototype.connectAux=function(e){var t=this;return new Promise((function(n,o){t.openvidu.startWs((function(r){if(r)o(r);else{var a={token:e||"",session:t.sessionId,platform:v.description?v.description:"unknown",metadata:t.options.metadata?t.options.metadata:"",secret:t.openvidu.getSecret(),recorder:t.openvidu.getRecorder()};t.openvidu.sendRequest("joinRoom",a,(function(e,r){if(e)o(e);else{t.capabilities={subscribe:!0,publish:"SUBSCRIBER"!==t.openvidu.role,forceUnpublish:"MODERATOR"===t.openvidu.role,forceDisconnect:"MODERATOR"===t.openvidu.role},t.connection=new i.Connection(t),t.connection.connectionId=r.id,t.connection.creationTime=r.createdAt,t.connection.data=r.metadata,t.connection.rpcSessionId=r.sessionId;var a={connections:new Array,streams:new Array};r.value.forEach((function(e){var n=new i.Connection(t,e);t.remoteConnections[n.connectionId]=n,a.connections.push(n),n.stream&&(t.remoteStreamsCreated[n.stream.streamId]=!0,a.streams.push(n.stream))})),t.ee.emitEvent("connectionCreated",[new s.ConnectionEvent(!1,t,"connectionCreated",t.connection,"")]),a.connections.forEach((function(e){t.ee.emitEvent("connectionCreated",[new s.ConnectionEvent(!1,t,"connectionCreated",e,"")])})),a.streams.forEach((function(e){t.ee.emitEvent("streamCreated",[new p.StreamEvent(!1,t,"streamCreated",e,"")])})),n()}}))}}))}))},e.prototype.stopPublisherStream=function(e){this.connection.stream&&(this.connection.stream.disposeWebRtcPeer(),this.connection.stream.isLocalStreamPublished&&this.connection.stream.ee.emitEvent("local-stream-destroyed",[e]))},e.prototype.stringClientMetadata=function(e){return"string"!=typeof e?JSON.stringify(e):e},e.prototype.getConnection=function(e,t){var n=this;return new Promise((function(i,o){var r=n.remoteConnections[e];r?i(r):n.connection.connectionId===e?i(n.connection):o(new f.OpenViduError(f.OpenViduErrorName.GENERIC_ERROR,t))}))},e.prototype.getRemoteConnection=function(e,t){var n=this;return new Promise((function(i,o){var r=n.remoteConnections[e];r?i(r):o(new f.OpenViduError(f.OpenViduErrorName.GENERIC_ERROR,t))}))},e.prototype.processToken=function(e){var t=e.match(/^(wss?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)([\/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/);if(t){var n={protocol:t[1],host:t[2],hostname:t[3],port:t[4],pathname:t[5],search:t[6],hash:t[7]},i=e.split("?"),o=decodeURI(i[1]).split("&").map((function(e){return e.split("=")})).reduce((function(e,t){var n=t[0],i=t[1];return e[n]=i,e}),{});this.sessionId=o.sessionId;var r=o.secret,s=o.recorder,a=o.turnUsername,c=o.turnCredential,d=o.role,u=o.webrtcStatsInterval,p=o.version;if(r&&(this.openvidu.secret=r),s&&(this.openvidu.recorder=!0),a&&c){var l="stun:"+n.hostname+":3478",f="turn:"+n.hostname+":3478",h=f+"?transport=tcp";this.openvidu.iceServers=[{urls:[l]},{urls:[f,h],username:a,credential:c}]}d&&(this.openvidu.role=d),u&&(this.openvidu.webrtcStatsInterval=+u),p&&this.openvidu.libraryVersion,this.openvidu.wsUri="wss://"+n.host+"/openvidu",this.openvidu.httpUri="https://"+n.host}},e}();n.Session=b},{"../OpenViduInternal/Enums/OpenViduError":28,"../OpenViduInternal/Enums/VideoInsertMode":29,"../OpenViduInternal/Events/ConnectionEvent":30,"../OpenViduInternal/Events/FilterEvent":32,"../OpenViduInternal/Events/RecordingEvent":34,"../OpenViduInternal/Events/SessionDisconnectedEvent":35,"../OpenViduInternal/Events/SignalEvent":36,"../OpenViduInternal/Events/StreamEvent":37,"../OpenViduInternal/Events/StreamPropertyChangedEvent":39,"./Connection":18,"./Filter":19,"./Subscriber":26,platform:8,"wolfy87-eventemitter":15}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("./Filter"),o=e("./Subscriber"),r=e("../OpenViduInternal/WebRtcPeer/WebRtcPeer"),s=e("../OpenViduInternal/WebRtcStats/WebRtcStats"),a=e("../OpenViduInternal/Events/PublisherSpeakingEvent"),c=e("../OpenViduInternal/Events/StreamManagerEvent"),d=e("../OpenViduInternal/Events/StreamPropertyChangedEvent"),u=e("../OpenViduInternal/Enums/OpenViduError"),p=e("wolfy87-eventemitter"),l=e("hark"),f=e("platform"),h=function(){function e(e,t){var n=this;this.ee=new p,this.isSubscribeToRemote=!1,this.isLocalStreamReadyToPublish=!1,this.isLocalStreamPublished=!1,this.publishedOnce=!1,this.publisherStartSpeakingEventEnabled=!1,this.publisherStopSpeakingEventEnabled=!1,this.volumeChangeEventEnabled=!1,this.session=e,t.hasOwnProperty("id")?(this.inboundStreamOpts=t,this.streamId=this.inboundStreamOpts.id,this.creationTime=this.inboundStreamOpts.createdAt,this.hasAudio=this.inboundStreamOpts.hasAudio,this.hasVideo=this.inboundStreamOpts.hasVideo,this.hasAudio&&(this.audioActive=this.inboundStreamOpts.audioActive),this.hasVideo&&(this.videoActive=this.inboundStreamOpts.videoActive,this.typeOfVideo=this.inboundStreamOpts.typeOfVideo?this.inboundStreamOpts.typeOfVideo:void 0,this.frameRate=-1===this.inboundStreamOpts.frameRate?void 0:this.inboundStreamOpts.frameRate,this.videoDimensions=this.inboundStreamOpts.videoDimensions),this.inboundStreamOpts.filter&&Object.keys(this.inboundStreamOpts.filter).length>0&&(this.inboundStreamOpts.filter.lastExecMethod&&0===Object.keys(this.inboundStreamOpts.filter.lastExecMethod).length&&delete this.inboundStreamOpts.filter.lastExecMethod,this.filter=this.inboundStreamOpts.filter)):(this.outboundStreamOpts=t,this.hasAudio=this.isSendAudio(),this.hasVideo=this.isSendVideo(),this.hasAudio&&(this.audioActive=!!this.outboundStreamOpts.publisherProperties.publishAudio),this.hasVideo&&(this.videoActive=!!this.outboundStreamOpts.publisherProperties.publishVideo,this.frameRate=this.outboundStreamOpts.publisherProperties.frameRate,"undefined"!=typeof MediaStreamTrack&&this.outboundStreamOpts.publisherProperties.videoSource instanceof MediaStreamTrack?this.typeOfVideo="CUSTOM":this.typeOfVideo=this.isSendScreen()?"SCREEN":"CAMERA"),this.outboundStreamOpts.publisherProperties.filter&&(this.filter=this.outboundStreamOpts.publisherProperties.filter)),this.ee.on("mediastream-updated",(function(){n.streamManager.updateMediaStream(n.mediaStream)}))}return e.prototype.on=function(e,t){return this.ee.on(e,(function(e){t(e)})),this},e.prototype.once=function(e,t){return this.ee.once(e,(function(e){t(e)})),this},e.prototype.off=function(e,t){return t?this.ee.off(e,t):this.ee.removeAllListeners(e),this},e.prototype.applyFilter=function(e,t){var n=this;return new Promise((function(o,r){"string"!=typeof(t=t||{})&&(t=JSON.stringify(t)),n.session.openvidu.sendRequest("applyFilter",{streamId:n.streamId,type:e,options:t},(function(s,a){if(s)401===s.code?r(new u.OpenViduError(u.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to apply a filter")):r(s);else{var c=n.filter;n.filter=new i.Filter(e,t),n.filter.stream=n,n.session.emitEvent("streamPropertyChanged",[new d.StreamPropertyChangedEvent(n.session,n,"filter",n.filter,c,"applyFilter")]),n.streamManager.emitEvent("streamPropertyChanged",[new d.StreamPropertyChangedEvent(n.streamManager,n,"filter",n.filter,c,"applyFilter")]),o(n.filter)}}))}))},e.prototype.removeFilter=function(){var e=this;return new Promise((function(t,n){e.session.openvidu.sendRequest("removeFilter",{streamId:e.streamId},(function(i,o){if(i)401===i.code?n(new u.OpenViduError(u.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to remove a filter")):n(i);else{var r=e.filter;delete e.filter,e.session.emitEvent("streamPropertyChanged",[new d.StreamPropertyChangedEvent(e.session,e,"filter",e.filter,r,"applyFilter")]),e.streamManager.emitEvent("streamPropertyChanged",[new d.StreamPropertyChangedEvent(e.streamManager,e,"filter",e.filter,r,"applyFilter")]),t()}}))}))},e.prototype.getMediaStream=function(){return this.mediaStream},e.prototype.setMediaStream=function(e){this.mediaStream=e},e.prototype.updateMediaStreamInVideos=function(){this.ee.emitEvent("mediastream-updated",[])},e.prototype.getWebRtcPeer=function(){return this.webRtcPeer},e.prototype.getRTCPeerConnection=function(){return this.webRtcPeer.pc},e.prototype.subscribeToMyRemote=function(e){this.isSubscribeToRemote=e},e.prototype.setOutboundStreamOptions=function(e){this.outboundStreamOpts=e},e.prototype.subscribe=function(){var e=this;return new Promise((function(t,n){e.initWebRtcPeerReceive().then((function(){t()})).catch((function(e){n(e)}))}))},e.prototype.publish=function(){var e=this;return new Promise((function(t,n){e.isLocalStreamReadyToPublish?e.initWebRtcPeerSend().then((function(){t()})).catch((function(e){n(e)})):e.ee.once("stream-ready-to-publish",(function(){e.publish().then((function(){t()})).catch((function(e){n(e)}))}))}))},e.prototype.disposeWebRtcPeer=function(){if(this.webRtcPeer){var e=!!this.outboundStreamOpts&&"undefined"!=typeof MediaStreamTrack&&this.outboundStreamOpts.publisherProperties.videoSource instanceof MediaStreamTrack;this.webRtcPeer.dispose(e)}this.speechEvent&&(this.speechEvent.stop&&this.speechEvent.stop(),delete this.speechEvent),this.stopWebRtcStats()},e.prototype.disposeMediaStream=function(){this.mediaStream&&(this.mediaStream.getAudioTracks().forEach((function(e){e.stop()})),this.mediaStream.getVideoTracks().forEach((function(e){e.stop()})),delete this.mediaStream)},e.prototype.displayMyRemote=function(){return this.isSubscribeToRemote},e.prototype.isSendAudio=function(){return!!this.outboundStreamOpts&&null!==this.outboundStreamOpts.publisherProperties.audioSource&&!1!==this.outboundStreamOpts.publisherProperties.audioSource},e.prototype.isSendVideo=function(){return!!this.outboundStreamOpts&&null!==this.outboundStreamOpts.publisherProperties.videoSource&&!1!==this.outboundStreamOpts.publisherProperties.videoSource},e.prototype.isSendScreen=function(){var e="screen"===this.outboundStreamOpts.publisherProperties.videoSource;return"Electron"===f.name&&(e="string"==typeof this.outboundStreamOpts.publisherProperties.videoSource&&this.outboundStreamOpts.publisherProperties.videoSource.startsWith("screen:")),!!this.outboundStreamOpts&&e},e.prototype.setSpeechEventIfNotExists=function(){if(!this.speechEvent){var e=this.session.openvidu.advancedConfiguration.publisherSpeakingEventsOptions||{};e.interval="number"==typeof e.interval?e.interval:50,e.threshold="number"==typeof e.threshold?e.threshold:-50,this.speechEvent=l(this.mediaStream,e)}},e.prototype.enableSpeakingEvents=function(){var e=this;this.setSpeechEventIfNotExists(),this.publisherStartSpeakingEventEnabled||(this.publisherStartSpeakingEventEnabled=!0,this.speechEvent.on("speaking",(function(){e.session.emitEvent("publisherStartSpeaking",[new a.PublisherSpeakingEvent(e.session,"publisherStartSpeaking",e.connection,e.streamId)])}))),this.publisherStopSpeakingEventEnabled||(this.publisherStopSpeakingEventEnabled=!0,this.speechEvent.on("stopped_speaking",(function(){e.session.emitEvent("publisherStopSpeaking",[new a.PublisherSpeakingEvent(e.session,"publisherStopSpeaking",e.connection,e.streamId)])})))},e.prototype.enableOnceSpeakingEvents=function(){var e=this;this.setSpeechEventIfNotExists(),this.publisherStartSpeakingEventEnabled||(this.publisherStartSpeakingEventEnabled=!0,this.speechEvent.once("speaking",(function(){e.session.emitEvent("publisherStartSpeaking",[new a.PublisherSpeakingEvent(e.session,"publisherStartSpeaking",e.connection,e.streamId)]),e.disableSpeakingEvents()}))),this.publisherStopSpeakingEventEnabled||(this.publisherStopSpeakingEventEnabled=!0,this.speechEvent.once("stopped_speaking",(function(){e.session.emitEvent("publisherStopSpeaking",[new a.PublisherSpeakingEvent(e.session,"publisherStopSpeaking",e.connection,e.streamId)]),e.disableSpeakingEvents()})))},e.prototype.disableSpeakingEvents=function(){this.speechEvent&&(this.volumeChangeEventEnabled?(this.speechEvent.off("speaking"),this.speechEvent.off("stopped_speaking")):(this.speechEvent.stop(),delete this.speechEvent)),this.publisherStartSpeakingEventEnabled=!1,this.publisherStopSpeakingEventEnabled=!1},e.prototype.enableVolumeChangeEvent=function(){var e=this;this.setSpeechEventIfNotExists(),this.volumeChangeEventEnabled||(this.volumeChangeEventEnabled=!0,this.speechEvent.on("volume_change",(function(t){var n={newValue:t,oldValue:e.speechEvent.oldVolumeValue};e.speechEvent.oldVolumeValue=t,e.streamManager.emitEvent("streamAudioVolumeChange",[new c.StreamManagerEvent(e.streamManager,"streamAudioVolumeChange",n)])})))},e.prototype.enableOnceVolumeChangeEvent=function(){var e=this;this.setSpeechEventIfNotExists(),this.volumeChangeEventEnabled||(this.volumeChangeEventEnabled=!0,this.speechEvent.once("volume_change",(function(t){var n={newValue:t,oldValue:e.speechEvent.oldVolumeValue};e.speechEvent.oldVolumeValue=t,e.disableVolumeChangeEvent(),e.streamManager.emitEvent("streamAudioVolumeChange",[new c.StreamManagerEvent(e.streamManager,"streamAudioVolumeChange",n)])})))},e.prototype.disableVolumeChangeEvent=function(){this.speechEvent&&(this.session.speakingEventsEnabled?this.speechEvent.off("volume_change"):(this.speechEvent.stop(),delete this.speechEvent)),this.volumeChangeEventEnabled=!1},e.prototype.isLocal=function(){return!this.inboundStreamOpts&&!!this.outboundStreamOpts},e.prototype.getSelectedIceCandidate=function(){var e=this;return new Promise((function(t,n){e.webRtcStats.getSelectedIceCandidateInfo().then((function(e){return t(e)})).catch((function(e){return n(e)}))}))},e.prototype.getRemoteIceCandidateList=function(){return this.webRtcPeer.remoteCandidatesQueue},e.prototype.getLocalIceCandidateList=function(){return this.webRtcPeer.localCandidatesQueue},e.prototype.initWebRtcPeerSend=function(){var e=this;return new Promise((function(t,n){var i={audio:e.isSendAudio(),video:e.isSendVideo()},o={mediaStream:e.mediaStream,mediaConstraints:i,onicecandidate:e.connection.sendIceCandidate.bind(e.connection),iceServers:e.getIceServersConf(),simulcast:!1},s=function(i){var o="";e.isSendVideo()&&(o="undefined"!=typeof MediaStreamTrack&&e.outboundStreamOpts.publisherProperties.videoSource instanceof MediaStreamTrack?"CUSTOM":e.isSendScreen()?"SCREEN":"CAMERA"),e.session.openvidu.sendRequest("publishVideo",{sdpOffer:i,doLoopback:e.displayMyRemote()||!1,hasAudio:e.isSendAudio(),hasVideo:e.isSendVideo(),audioActive:e.audioActive,videoActive:e.videoActive,typeOfVideo:o,frameRate:e.frameRate?e.frameRate:-1,videoDimensions:JSON.stringify(e.videoDimensions),filter:e.outboundStreamOpts.publisherProperties.filter},(function(i,o){i?401===i.code?n(new u.OpenViduError(u.OpenViduErrorName.OPENVIDU_PERMISSION_DENIED,"You don't have permissions to publish")):n("Error on publishVideo: "+JSON.stringify(i)):e.webRtcPeer.processAnswer(o.sdpAnswer,!1).then((function(){e.streamId=o.id,e.creationTime=o.createdAt,e.isLocalStreamPublished=!0,e.publishedOnce=!0,e.displayMyRemote()&&e.remotePeerSuccessfullyEstablished(),e.ee.emitEvent("stream-created-by-publisher",[]),e.initWebRtcStats(),t()})).catch((function(e){n(e)}))}))};e.displayMyRemote()?e.webRtcPeer=new r.WebRtcPeerSendrecv(o):e.webRtcPeer=new r.WebRtcPeerSendonly(o),e.webRtcPeer.generateOffer().then((function(e){s(e)})).catch((function(e){n(new Error("(publish) SDP offer error: "+JSON.stringify(e)))}))}))},e.prototype.initWebRtcPeerReceive=function(){var e=this;return new Promise((function(t,n){var i={audio:e.inboundStreamOpts.hasAudio,video:e.inboundStreamOpts.hasVideo},o={onicecandidate:e.connection.sendIceCandidate.bind(e.connection),mediaConstraints:i,iceServers:e.getIceServersConf(),simulcast:!1},s=function(i){e.session.openvidu.sendRequest("receiveVideoFrom",{sender:e.streamId,sdpOffer:i},(function(i,o){if(i)n(new Error("Error on recvVideoFrom: "+JSON.stringify(i)));else{e.session.isFirstIonicIosSubscriber&&(e.session.isFirstIonicIosSubscriber=!1,setTimeout((function(){e.session.countDownForIonicIosSubscribersActive=!1}),400));var r=e.session.countDownForIonicIosSubscribersActive;e.webRtcPeer.processAnswer(o.sdpAnswer,r).then((function(){e.remotePeerSuccessfullyEstablished(),e.initWebRtcStats(),t()})).catch((function(e){n(e)}))}}))};e.webRtcPeer=new r.WebRtcPeerRecvonly(o),e.webRtcPeer.generateOffer().then((function(e){s(e)})).catch((function(e){n(new Error("(subscribe) SDP offer error: "+JSON.stringify(e)))}))}))},e.prototype.remotePeerSuccessfullyEstablished=function(){if(f.isIonicIos){var e=this.webRtcPeer.pc;this.mediaStream=e.getRemoteStreams()[0]}else{this.mediaStream=new MediaStream;for(var t=void 0,n=0,i=this.webRtcPeer.pc.getReceivers();n<i.length;n++)(t=i[n]).track&&this.mediaStream.addTrack(t.track)}if(this.mediaStream){if(this.streamManager instanceof o.Subscriber){if(this.mediaStream.getAudioTracks()[0]){var r=!!this.streamManager.properties.subscribeToAudio;this.mediaStream.getAudioTracks()[0].enabled=r}this.mediaStream.getVideoTracks()[0]&&(r=!!this.streamManager.properties.subscribeToVideo,this.mediaStream.getVideoTracks()[0].enabled=r)}this.updateMediaStreamInVideos(),!this.displayMyRemote()&&this.mediaStream.getAudioTracks()[0]&&this.session.speakingEventsEnabled&&this.enableSpeakingEvents()}},e.prototype.initWebRtcStats=function(){this.webRtcStats=new s.WebRtcStats(this),this.webRtcStats.initWebRtcStats()},e.prototype.stopWebRtcStats=function(){this.webRtcStats&&this.webRtcStats.isEnabled()&&this.webRtcStats.stopWebRtcStats()},e.prototype.getIceServersConf=function(){return this.session.openvidu.advancedConfiguration.iceServers?"freeice"===this.session.openvidu.advancedConfiguration.iceServers?void 0:this.session.openvidu.advancedConfiguration.iceServers:this.session.openvidu.iceServers?this.session.openvidu.iceServers:void 0},e.prototype.gatherStatsForPeer=function(){var e=this;return new Promise((function(t,n){e.isLocal()?e.getRTCPeerConnection().getSenders().forEach((function(t){return t.getStats().then((function(t){t.forEach((function(t){if(e.isReportWanted(t)){var n={};n.type=t.type,n.timestamp=t.timestamp,n.id=t.id,"outbound-rtp"===t.type&&(n.ssrc=t.ssrc,n.firCount=t.firCount,n.pliCount=t.pliCount,n.nackCount=t.nackCount,n.qpSum=t.qpSum,t.kind?n.mediaType=t.kind:t.mediaType?n.mediaType=t.mediaType:n.mediaType=-1!==t.id.indexOf("VideoStream")?"video":"audio","video"===n.mediaType&&(n.framesEncoded=t.framesEncoded),n.packetsSent=t.packetsSent,n.bytesSent=t.bytesSent),"candidate-pair"===t.type&&void 0!==t.totalRoundTripTime&&(n.availableOutgoingBitrate=t.availableOutgoingBitrate,n.rtt=t.currentRoundTripTime,n.averageRtt=t.totalRoundTripTime/t.responsesReceived),"remote-inbound-rtp"===t.type||t.type}}))}))})):e.getRTCPeerConnection().getReceivers().forEach((function(t){return t.getStats().then((function(t){t.forEach((function(t){if(e.isReportWanted(t)){var n={};n.type=t.type,n.timestamp=t.timestamp,n.id=t.id,"inbound-rtp"===t.type&&(n.ssrc=t.ssrc,n.firCount=t.firCount,n.pliCount=t.pliCount,n.nackCount=t.nackCount,n.qpSum=t.qpSum,t.kind?n.mediaType=t.kind:t.mediaType?n.mediaType=t.mediaType:n.mediaType=-1!==t.id.indexOf("VideoStream")?"video":"audio","video"===n.mediaType&&(n.framesDecoded=t.framesDecoded),n.packetsReceived=t.packetsReceived,n.packetsLost=t.packetsLost,n.jitter=t.jitter,n.bytesReceived=t.bytesReceived),"candidate-pair"===t.type&&void 0!==t.totalRoundTripTime&&(n.availableIncomingBitrate=t.availableIncomingBitrate,n.rtt=t.currentRoundTripTime,n.averageRtt=t.totalRoundTripTime/t.responsesReceived),"remote-inbound-rtp"===t.type||t.type}}))}))}))}))},e.prototype.isReportWanted=function(e){return"inbound-rtp"===e.type&&!this.isLocal()||"outbound-rtp"===e.type&&this.isLocal()||"candidate-pair"===e.type&&e.nominated&&e.bytesSent>0},e}();n.Stream=h},{"../OpenViduInternal/Enums/OpenViduError":28,"../OpenViduInternal/Events/PublisherSpeakingEvent":33,"../OpenViduInternal/Events/StreamManagerEvent":38,"../OpenViduInternal/Events/StreamPropertyChangedEvent":39,"../OpenViduInternal/WebRtcPeer/WebRtcPeer":52,"../OpenViduInternal/WebRtcStats/WebRtcStats":53,"./Filter":19,"./Subscriber":26,hark:5,platform:8,"wolfy87-eventemitter":15}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../OpenViduInternal/Events/StreamManagerEvent"),o=e("../OpenViduInternal/Events/VideoElementEvent"),r=e("../OpenViduInternal/Enums/VideoInsertMode"),s=e("wolfy87-eventemitter"),a=e("platform"),c=function(){function e(e,t){var n=this;if(this.videos=[],this.lazyLaunchVideoElementCreatedEvent=!1,this.ee=new s,this.stream=e,this.stream.streamManager=this,this.remote=!this.stream.isLocal(),t){var r=void 0;"string"==typeof t?r=document.getElementById(t):t instanceof HTMLElement&&(r=t),r&&(this.firstVideoElement={targetElement:r,video:document.createElement("video"),id:"",canplayListenerAdded:!1},"Safari"===a.name&&this.firstVideoElement.video.setAttribute("playsinline","true"),this.targetElement=r,this.element=r)}this.canPlayListener=function(){n.stream.isLocal()&&n.stream.displayMyRemote()?n.ee.emitEvent("remoteVideoPlaying",[new o.VideoElementEvent(n.videos[0].video,n,"remoteVideoPlaying")]):n.ee.emitEvent("videoPlaying",[new o.VideoElementEvent(n.videos[0].video,n,"videoPlaying")]),n.ee.emitEvent("streamPlaying",[new i.StreamManagerEvent(n,"streamPlaying",void 0)])}}return e.prototype.on=function(e,t){return this.ee.on(e,(function(e){t(e)})),"videoElementCreated"===e&&this.stream&&this.lazyLaunchVideoElementCreatedEvent&&(this.ee.emitEvent("videoElementCreated",[new o.VideoElementEvent(this.videos[0].video,this,"videoElementCreated")]),this.lazyLaunchVideoElementCreatedEvent=!1),"streamPlaying"!==e&&"videoPlaying"!==e||this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&!1===this.videos[0].video.paused&&!1===this.videos[0].video.ended&&4===this.videos[0].video.readyState&&(this.ee.emitEvent("streamPlaying",[new i.StreamManagerEvent(this,"streamPlaying",void 0)]),this.ee.emitEvent("videoPlaying",[new o.VideoElementEvent(this.videos[0].video,this,"videoPlaying")])),"streamAudioVolumeChange"===e&&this.stream.hasAudio&&this.stream.enableVolumeChangeEvent(),this},e.prototype.once=function(e,t){return this.ee.once(e,(function(e){t(e)})),"videoElementCreated"===e&&this.stream&&this.lazyLaunchVideoElementCreatedEvent&&this.ee.emitEvent("videoElementCreated",[new o.VideoElementEvent(this.videos[0].video,this,"videoElementCreated")]),"streamPlaying"!==e&&"videoPlaying"!==e||this.videos[0]&&this.videos[0].video&&this.videos[0].video.currentTime>0&&!1===this.videos[0].video.paused&&!1===this.videos[0].video.ended&&4===this.videos[0].video.readyState&&(this.ee.emitEvent("streamPlaying",[new i.StreamManagerEvent(this,"streamPlaying",void 0)]),this.ee.emitEvent("videoPlaying",[new o.VideoElementEvent(this.videos[0].video,this,"videoPlaying")])),"streamAudioVolumeChange"===e&&this.stream.hasAudio&&this.stream.enableOnceVolumeChangeEvent(),this},e.prototype.off=function(e,t){return t?this.ee.off(e,t):this.ee.removeAllListeners(e),"streamAudioVolumeChange"===e&&this.stream.disableVolumeChangeEvent(),this},e.prototype.addVideoElement=function(e){this.initializeVideoProperties(e),this.stream.isLocal()&&this.stream.displayMyRemote()&&e.srcObject!==this.stream.getMediaStream()&&(e.srcObject=this.stream.getMediaStream());for(var t=0,n=this.videos;t<n.length;t++)if(n[t].video===e)return 0;for(var i=1,o=0,r=this.stream.session.streamManagers;o<r.length;o++)if(r[o].disassociateVideo(e)){i=-1;break}return this.stream.session.streamManagers.forEach((function(t){t.disassociateVideo(e)})),this.pushNewStreamManagerVideo({video:e,id:e.id,canplayListenerAdded:!1}),i},e.prototype.createVideoElement=function(e,t){var n;if("string"==typeof e){if(!(n=document.getElementById(e)))throw new Error("The provided 'targetElement' couldn't be resolved to any HTML element: "+e)}else{if(!(e instanceof HTMLElement))throw new Error("The provided 'targetElement' couldn't be resolved to any HTML element: "+e);n=e}var i=document.createElement("video");this.initializeVideoProperties(i);var s=t||r.VideoInsertMode.APPEND;switch(s){case r.VideoInsertMode.AFTER:n.parentNode.insertBefore(i,n.nextSibling);break;case r.VideoInsertMode.APPEND:n.appendChild(i);break;case r.VideoInsertMode.BEFORE:n.parentNode.insertBefore(i,n);break;case r.VideoInsertMode.PREPEND:n.insertBefore(i,n.childNodes[0]);break;case r.VideoInsertMode.REPLACE:n.parentNode.replaceChild(i,n);break;default:s=r.VideoInsertMode.APPEND,n.appendChild(i)}var a={targetElement:n,video:i,insertMode:s,id:i.id,canplayListenerAdded:!1};return this.pushNewStreamManagerVideo(a),this.ee.emitEvent("videoElementCreated",[new o.VideoElementEvent(a.video,this,"videoElementCreated")]),this.lazyLaunchVideoElementCreatedEvent=!!this.firstVideoElement,i},e.prototype.initializeVideoProperties=function(e){this.stream.isLocal()&&this.stream.displayMyRemote()||e.srcObject!==this.stream.getMediaStream()&&(e.srcObject=this.stream.getMediaStream()),e.autoplay=!0,e.controls=!1,"Safari"===a.name&&e.setAttribute("playsinline","true"),e.id||(e.id=(this.remote?"remote-":"local-")+"video-"+this.stream.streamId,!this.id&&this.targetElement&&(this.id=e.id)),this.remote||this.stream.displayMyRemote()||(e.muted=!0,"rotateY(180deg)"!==e.style.transform||this.stream.outboundStreamOpts.publisherProperties.mirror?this.stream.outboundStreamOpts.publisherProperties.mirror&&!this.stream.isSendScreen()&&this.mirrorVideo(e):this.removeMirrorVideo(e))},e.prototype.removeAllVideos=function(){for(var e=this,t=this.stream.session.streamManagers.length-1;t>=0;--t)this.stream.session.streamManagers[t]===this&&this.stream.session.streamManagers.splice(t,1);this.videos.forEach((function(t){t.video.removeEventListener("canplay",e.canPlayListener),t.canplayListenerAdded=!1,t.targetElement&&(t.video.parentNode.removeChild(t.video),e.ee.emitEvent("videoElementDestroyed",[new o.VideoElementEvent(t.video,e,"videoElementDestroyed")])),t.video.srcObject=null,e.videos.filter((function(e){return!e.targetElement}))}))},e.prototype.disassociateVideo=function(e){for(var t=!1,n=0;n<this.videos.length;n++)if(this.videos[n].video===e){this.videos[n].video.removeEventListener("canplay",this.canPlayListener),this.videos.splice(n,1),t=!0;break}return t},e.prototype.addPlayEventToFirstVideo=function(){this.videos[0]&&this.videos[0].video&&!this.videos[0].canplayListenerAdded&&(this.videos[0].video.addEventListener("canplay",this.canPlayListener),this.videos[0].canplayListenerAdded=!0)},e.prototype.updateMediaStream=function(e){this.videos.forEach((function(t){if(t.video.srcObject=e,a.isIonicIos){var n=t.video.parentElement,i=t.video;n.replaceChild(i,t.video),t.video=i}}))},e.prototype.emitEvent=function(e,t){this.ee.emitEvent(e,t)},e.prototype.pushNewStreamManagerVideo=function(e){this.videos.push(e),this.addPlayEventToFirstVideo(),-1===this.stream.session.streamManagers.indexOf(this)&&this.stream.session.streamManagers.push(this)},e.prototype.mirrorVideo=function(e){a.isIonicIos||(e.style.transform="rotateY(180deg)",e.style.webkitTransform="rotateY(180deg)")},e.prototype.removeMirrorVideo=function(e){e.style.transform="unset",e.style.webkitTransform="unset"},e}();n.StreamManager=c},{"../OpenViduInternal/Enums/VideoInsertMode":29,"../OpenViduInternal/Events/StreamManagerEvent":38,"../OpenViduInternal/Events/VideoElementEvent":40,platform:8,"wolfy87-eventemitter":15}],26:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){function t(t,n,i){var o=e.call(this,t,n)||this;return o.element=o.targetElement,o.stream=t,o.properties=i,o}return o(t,e),t.prototype.subscribeToAudio=function(e){return this.stream.getMediaStream().getAudioTracks().forEach((function(t){t.enabled=e})),this},t.prototype.subscribeToVideo=function(e){return this.stream.getMediaStream().getVideoTracks().forEach((function(t){t.enabled=e})),this},t}(e("./StreamManager").StreamManager);n.Subscriber=r},{"./StreamManager":25}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(e){e.READY="READY",e.RECORDING="RECORDING",e.PAUSED="PAUSED",e.FINISHED="FINISHED"}(n.LocalRecorderState||(n.LocalRecorderState={}))},{}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(e){e.BROWSER_NOT_SUPPORTED="BROWSER_NOT_SUPPORTED",e.DEVICE_ACCESS_DENIED="DEVICE_ACCESS_DENIED",e.DEVICE_ALREADY_IN_USE="DEVICE_ALREADY_IN_USE",e.SCREEN_CAPTURE_DENIED="SCREEN_CAPTURE_DENIED",e.SCREEN_SHARING_NOT_SUPPORTED="SCREEN_SHARING_NOT_SUPPORTED",e.SCREEN_EXTENSION_NOT_INSTALLED="SCREEN_EXTENSION_NOT_INSTALLED",e.SCREEN_EXTENSION_DISABLED="SCREEN_EXTENSION_DISABLED",e.INPUT_VIDEO_DEVICE_NOT_FOUND="INPUT_VIDEO_DEVICE_NOT_FOUND",e.INPUT_AUDIO_DEVICE_NOT_FOUND="INPUT_AUDIO_DEVICE_NOT_FOUND",e.NO_INPUT_SOURCE_SET="NO_INPUT_SOURCE_SET",e.PUBLISHER_PROPERTIES_ERROR="PUBLISHER_PROPERTIES_ERROR",e.OPENVIDU_PERMISSION_DENIED="OPENVIDU_PERMISSION_DENIED",e.OPENVIDU_NOT_CONNECTED="OPENVIDU_NOT_CONNECTED",e.GENERIC_ERROR="GENERIC_ERROR"}(n.OpenViduErrorName||(n.OpenViduErrorName={})),n.OpenViduError=function(e,t){this.name=e,this.message=t}},{}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(e){e.AFTER="AFTER",e.APPEND="APPEND",e.BEFORE="BEFORE",e.PREPEND="PREPEND",e.REPLACE="REPLACE"}(n.VideoInsertMode||(n.VideoInsertMode={}))},{}],30:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){function t(t,n,i,o,r){var s=e.call(this,t,n,i)||this;return s.connection=o,s.reason=r,s}return o(t,e),t.prototype.callDefaultBehavior=function(){},t}(e("./Event").Event);n.ConnectionEvent=r},{"./Event":31}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t,n){this.hasBeenPrevented=!1,this.cancelable=e,this.target=t,this.type=n}return e.prototype.isDefaultPrevented=function(){return this.hasBeenPrevented},e.prototype.preventDefault=function(){this.callDefaultBehavior=function(){},this.hasBeenPrevented=!0},e}();n.Event=i},{}],32:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){function t(t,n,i){var o=e.call(this,!1,t,n)||this;return o.data=i,o}return o(t,e),t.prototype.callDefaultBehavior=function(){},t}(e("./Event").Event);n.FilterEvent=r},{"./Event":31}],33:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){function t(t,n,i,o){var r=e.call(this,!1,t,n)||this;return r.type=n,r.connection=i,r.streamId=o,r}return o(t,e),t.prototype.callDefaultBehavior=function(){},t}(e("./Event").Event);n.PublisherSpeakingEvent=r},{"./Event":31}],34:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){function t(t,n,i,o,r){var s=e.call(this,!1,t,n)||this;return s.id=i,o!==i&&(s.name=o),s.reason=r,s}return o(t,e),t.prototype.callDefaultBehavior=function(){},t}(e("./Event").Event);n.RecordingEvent=r},{"./Event":31}],35:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){function t(t,n){var i=e.call(this,!0,t,"sessionDisconnected")||this;return i.reason=n,i}return o(t,e),t.prototype.callDefaultBehavior=function(){var e=this.target;for(var t in e.remoteConnections)e.remoteConnections[t].stream&&(e.remoteConnections[t].stream.disposeWebRtcPeer(),e.remoteConnections[t].stream.disposeMediaStream(),e.remoteConnections[t].stream.streamManager&&e.remoteConnections[t].stream.streamManager.removeAllVideos(),delete e.remoteStreamsCreated[e.remoteConnections[t].stream.streamId],e.remoteConnections[t].dispose()),delete e.remoteConnections[t]},t}(e("./Event").Event);n.SessionDisconnectedEvent=r},{"./Event":31}],36:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){function t(t,n,i,o){var r=e.call(this,!1,t,n)||this;return r.type=n,r.data=i,r.from=o,r}return o(t,e),t.prototype.callDefaultBehavior=function(){},t}(e("./Event").Event);n.SignalEvent=r},{"./Event":31}],37:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var r=e("./Event"),s=e("../../OpenVidu/Publisher"),a=e("../../OpenVidu/Session"),c=function(e){function t(t,n,i,o,r){var s=e.call(this,t,n,i)||this;return s.stream=o,s.reason=r,s}return o(t,e),t.prototype.callDefaultBehavior=function(){if("streamDestroyed"===this.type){if(this.target instanceof a.Session)this.stream.disposeWebRtcPeer();else if(this.target instanceof s.Publisher){clearInterval(this.target.screenShareResizeInterval),this.stream.isLocalStreamReadyToPublish=!1;for(var e=this.target.openvidu.publishers,t=0;t<e.length;t++)if(e[t]===this.target){e.splice(t,1);break}}this.stream.disposeMediaStream(),this.stream.streamManager&&this.stream.streamManager.removeAllVideos(),delete this.stream.session.remoteStreamsCreated[this.stream.streamId];var n=this.stream.session.remoteConnections[this.stream.connection.connectionId];if(n&&n.options){var i=n.options.streams;for(t=i.length-1;t>=0;--t)i[t].id===this.stream.streamId&&i.splice(t,1)}}},t}(r.Event);n.StreamEvent=c},{"../../OpenVidu/Publisher":22,"../../OpenVidu/Session":23,"./Event":31}],38:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){function t(t,n,i){var o=e.call(this,!1,t,n)||this;return o.value=i,o}return o(t,e),t.prototype.callDefaultBehavior=function(){},t}(e("./Event").Event);n.StreamManagerEvent=r},{"./Event":31}],39:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){function t(t,n,i,o,r,s){var a=e.call(this,!1,t,"streamPropertyChanged")||this;return a.stream=n,a.changedProperty=i,a.newValue=o,a.oldValue=r,a.reason=s,a}return o(t,e),t.prototype.callDefaultBehavior=function(){},t}(e("./Event").Event);n.StreamPropertyChangedEvent=r},{"./Event":31}],40:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){function t(t,n,i){var o=e.call(this,!1,n,i)||this;return o.element=t,o}return o(t,e),t.prototype.callDefaultBehavior=function(){},t}(e("./Event").Event);n.VideoElementEvent=r},{"./Event":31}],41:[function(e,t,n){function i(){var e={};this.forEach=function(t){for(var n in e){var i=e[n];for(var o in i)t(i[o])}},this.get=function(t,n){var i=e[n];if(null!=i)return i[t]},this.remove=function(t,n){var i=e[n];if(null!=i){for(var o in delete i[t],i)return!1;delete e[n]}},this.set=function(t,n,i){if(null==t)return this.remove(n,i);var o=e[i];null==o&&(e[i]=o={}),o[n]=t}}i.prototype.pop=function(e,t){var n=this.get(e,t);if(null!=n)return this.remove(e,t),n},t.exports=i},{}],42:[function(e,t,n){var i=e("./jsonrpcclient");n.JsonRpcClient=i},{"./jsonrpcclient":43}],43:[function(e,t,n){var i=e("../"),o=e("./transports/webSocketWithReconnection");Date.now=Date.now||function(){return+new Date};var r="RECONNECTING",s="CONNECTED",a="DISCONNECTED",c=console;t.exports=function(e){function t(){c.debug("notReconnectIfNumLessThan = "+m+" (old="+h+")"),h=m}function n(){if(v){var n=null;0!=m&&m!=h||(n={interval:e.heartbeat||5e3}),m++,l.send("ping",n,(i=m,function(e,n){e&&(c.debug("Error in ping request #"+i+" ("+e.message+")"),i>h&&(v=!1,t(),c.debug("Server did not respond to ping message #"+i+". Reconnecting... "),O.reconnectWs()))}))}else c.debug("Trying to send ping, but ping is not enabled");var i}function d(){b||(c.debug("Starting ping (if configured)"),b=!0,null!=e.heartbeat&&(p=setInterval(n,e.heartbeat),n()))}function u(){clearInterval(p),b=!1,v=!1,m=-1,I.cancel()}var p,l=this,f=e.ws,h=-1,m=0,v=!0,b=!1,E=a,y=f.onreconnecting,g=f.onreconnected,S=f.onconnected,w=f.onerror;e.rpc.pull=function(e,t){t.reply(null,"push")},f.onreconnecting=function(){c.debug("--------- ONRECONNECTING -----------"),E!==r?(u(),E=r,y&&y()):c.error("Websocket already in RECONNECTING state when receiving a new ONRECONNECTING message. Ignoring it")},f.onreconnected=function(){c.debug("--------- ONRECONNECTED -----------"),E!==s?(E=s,t(),g&&g()):c.error("Websocket already in CONNECTED state when receiving a new ONRECONNECTED message. Ignoring it")},f.onconnected=function(){c.debug("--------- ONCONNECTED -----------"),E!==s?(E=s,v=!0,d(),S&&S()):c.error("Websocket already in CONNECTED state when receiving a new ONCONNECTED message. Ignoring it")},f.onerror=function(e){c.debug("--------- ONERROR -----------"),E=a,u(),w&&w(e)};var O=new o(f);c.debug("Connecting websocket to URI: "+f.uri);var R={request_timeout:e.rpc.requestTimeout,ping_request_timeout:e.rpc.heartbeatRequestTimeout},I=new i(i.packers.JsonRPC,R,O,(function(t){c.debug("Received request: "+JSON.stringify(t));try{var n=e.rpc[t.method];void 0===n?c.error("Method "+t.method+" not registered in client"):n(t.params,t)}catch(e){c.error("Exception processing request: "+JSON.stringify(t)),c.error(e)}}));this.send=function(e,t,n){"ping"!==e&&c.debug("Request: method:"+e+" params:"+JSON.stringify(t));var i=Date.now();I.encode(e,t,(function(o,r){if(o){try{c.error("ERROR:"+o.message+" in Request: method:"+e+" params:"+JSON.stringify(t)+" request:"+o.request),o.data&&c.error("ERROR DATA:"+JSON.stringify(o.data))}catch(e){}o.requestTime=i}n&&(null!=r&&"pong"!==r.value&&c.debug("Response: "+JSON.stringify(r)),n(o,r))}))},this.close=function(t,n){c.debug("Closing  with code: "+t+" because: "+n),null!=p&&(c.debug("Clearing ping interval"),clearInterval(p)),b=!1,v=!1,e.sendCloseMessage?(c.debug("Sending close message"),this.send("closeSession",null,(function(e,i){e&&c.error("Error sending close message: "+JSON.stringify(e)),O.close(t,n)}))):O.close(t,n)},this.forceClose=function(e){O.forceClose(e)},this.reconnect=function(){O.reconnectWs()},this.resetPing=function(){v=!0,m=0,d()}}},{"../":46,"./transports/webSocketWithReconnection":45}],44:[function(e,t,n){var i=e("./webSocketWithReconnection");n.WebSocketWithReconnection=i},{"./webSocketWithReconnection":45}],45:[function(e,t,n){(function(e){"use strict";e.WebSocket||e.MozWebSocket;var n=console;t.exports=function(e){function t(e,t){try{n.debug("WebSocket connected to "+t)}catch(e){n.error(e)}}function i(t,r){if(n.debug("reconnectToSameUri (attempt #"+r+", max="+t+")"),1===r){if(u)return void n.warn("Trying to reconnectToNewUri when reconnecting... Ignoring this reconnection.");u=!0,e.onreconnecting&&e.onreconnecting()}p?o(t,r,c):e.newWsUriOnReconnection?e.newWsUriOnReconnection((function(e,s){e?(n.debug(e),setTimeout((function(){i(t,r+1)}),3e3)):o(t,r,s)})):o(t,r,c)}function o(o,a,p){var f;n.debug("Reconnection attempt #"+a),s.close(),c=p||c,(f=d?new SockJS(c):new WebSocket(c)).onopen=function(){n.debug("Reconnected after "+a+" attempts..."),t(f,c),u=!1,r(),e.onreconnected()&&e.onreconnected(),f.onclose=l},f.onerror=function(t){n.warn("Reconnection error: ",t),a===o?e.ondisconnect&&e.ondisconnect():setTimeout((function(){i(o,a+1)}),3e3)},s=f}var r,s,a=!1,c=e.uri,d=e.useSockJS,u=!1,p=!1;(s=d?new SockJS(c):new WebSocket(c)).onopen=function(){t(s,c),e.onconnected&&e.onconnected()},s.onerror=function(t){n.error("Could not connect to "+c+" (invoking onerror if defined)",t),e.onerror&&e.onerror(t)};var l=function(){3===s.readyState?a?n.debug("Connection closed by user"):(n.debug("Connection closed unexpectecly. Reconnecting..."),i(2e3,1)):n.debug("Close callback from previous websocket. Ignoring it")};s.onclose=l,this.close=function(){a=!0,s.close()},this.forceClose=function(e){if(n.debug("Testing: Force WebSocket close"),e){n.debug("Testing: Change wsUri for "+e+" millis to simulate net failure");var t=c;c="wss://21.234.12.34.4:443/",p=!0,setTimeout((function(){n.debug("Testing: Recover good wsUri "+t),c=t,p=!1}),e)}s.close()},this.reconnectWs=function(){n.debug("reconnectWs"),i(2e3,1)},this.send=function(e){s.send(e)},this.addEventListener=function(e,t){(r=function(){s.addEventListener(e,t)})()}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],46:[function(e,t,n){function i(e){if(e){if(e instanceof Function)return{send:e};if(e.send instanceof Function)return e;if(e.postMessage instanceof Function)return e.send=e.postMessage,e;if(e.write instanceof Function)return e.send=e.write,e;if(void 0===e.onmessage&&!(e.pause instanceof Function))throw new SyntaxError("Transport is not a function nor a valid object")}}function o(e,t){s?(this.method=e,this.params=t):(Object.defineProperty(this,"method",{value:e,enumerable:!0}),Object.defineProperty(this,"params",{value:t,enumerable:!0}))}function r(e,t,n,r){function d(e){m.decode(e.data||e)}function l(e,t){var n=setTimeout((function(){I.remove(e,t)}),S);I.set(n,e,t)}function f(t,n,r,a,c){o.call(this,t,n),this.getTransport=function(){return c},this.setTransport=function(e){c=i(e)},s||Object.defineProperty(this,"transport",{get:this.getTransport.bind(this),set:this.setTransport.bind(this)});var d=R.get(r,a);c||m.getTransport()||(s?this.duplicated=Boolean(d):Object.defineProperty(this,"duplicated",{value:Boolean(d)}));var u=v[t];this.pack=e.pack.bind(e,this,r),this.reply=function(t,n,o){if(t instanceof Function||t&&t.send instanceof Function){if(null!=n)throw new SyntaxError("There can't be parameters after callback");o=t,n=null,t=void 0}else if(n instanceof Function||n&&n.send instanceof Function){if(null!=o)throw new SyntaxError("There can't be parameters after callback");o=n,n=null}var s;return o=i(o),d&&clearTimeout(d.timeout),null!=a&&(t&&(t.dest=a),n&&(n.dest=a)),t||null!=n?(null!=m.peerID&&(t?t.from=m.peerID:n.from=m.peerID),s=u?null==u.error&&t?{error:t}:{method:t?u.error:u.response,params:t||n}:{error:t,result:n},s=e.pack(s,r)):s=d?d.message:e.pack({result:null},r),function(e,t,n){var i={message:e,timeout:setTimeout((function(){R.remove(t,n)}),g)};R.set(i,t,n)}(s,r,a),(o=o||this.getTransport()||m.getTransport())?o.send(s):s}}function h(e){var t=C[e];if(t){delete C[e];var n=O.pop(t.id,t.dest);n&&(clearTimeout(n.timeout),l(t.id,t.dest))}}var m=this;if(!e)throw new SyntaxError("Packer is not defined");if(!e.pack||!e.unpack)throw new SyntaxError("Packer is invalid");var v=function(e){if(!e)return{};for(var t in e){var n=e[t];"string"==typeof n&&(e[t]={response:n})}return e}(e.responseMethods);if(t instanceof Function){if(null!=n)throw new SyntaxError("There can't be parameters after onRequest");r=t,n=void 0,t=void 0}if(t&&t.send instanceof Function){if(n&&!(n instanceof Function))throw new SyntaxError("Only a function can be after transport");r=n,n=t,t=void 0}if(n instanceof Function){if(null!=r)throw new SyntaxError("There can't be parameters after onRequest");r=n,n=void 0}if(n&&n.send instanceof Function&&r&&!(r instanceof Function))throw new SyntaxError("Only a function can be after transport");t=t||{},a.call(this),r&&this.on("request",r),s?this.peerID=t.peerID:Object.defineProperty(this,"peerID",{value:t.peerID});var b=t.max_retries||0;this.getTransport=function(){return n},this.setTransport=function(e){n&&(n.removeEventListener?n.removeEventListener("message",d):n.removeListener&&n.removeListener("data",d)),e&&(e.addEventListener?e.addEventListener("message",d):e.addListener&&e.addListener("data",d)),n=i(e)},s||Object.defineProperty(this,"transport",{get:this.getTransport.bind(this),set:this.setTransport.bind(this)}),this.setTransport(n);var E=t.request_timeout||p,y=t.ping_request_timeout||E,g=t.response_timeout||p,S=t.duplicates_timeout||p,w=0,O=new u,R=new u,I=new u,C={};c(f,o),this.cancel=function(e){if(e)return h(e);for(var e in C)h(e)},this.close=function(){var e=this.getTransport();e&&e.close&&e.close(4003,"Cancel request"),this.cancel(),I.forEach(clearTimeout),R.forEach((function(e){clearTimeout(e.timeout)}))},this.encode=function(t,n,o,r,s){if(n instanceof Function){if(null!=o)throw new SyntaxError("There can't be parameters after callback");s=n,r=void 0,o=void 0,n=void 0}else if(o instanceof Function){if(null!=r)throw new SyntaxError("There can't be parameters after callback");s=o,r=void 0,o=void 0}else if(r instanceof Function){if(null!=s)throw new SyntaxError("There can't be parameters after callback");s=r,r=void 0}null!=m.peerID&&((n=n||{}).from=m.peerID),null!=o&&((n=n||{}).dest=o);var a={method:t,params:n};if(s){var c=w++,d=0;function u(e,t){m.cancel(a),s(e,t)}var p={message:a=e.pack(a,c),callback:u,responseMethods:v[t]||{}},l=i(r);function f(e){var n="ping"===t?y:E;return p.timeout=setTimeout(g,n*Math.pow(2,d++)),C[a]={id:c,dest:o},O.set(p,c,o),(e=e||l||m.getTransport())?e.send(a):a}function h(e){e=i(e);var t=I.pop(c,o);return clearTimeout(t),f(e)}function g(){if(d<b)return h(r);var e=new Error("Request has timed out");e.request=a,e.retry=h,u(e)}return f(r)}return a=e.pack(a),(r=r||this.getTransport())?r.send(a):a},this.decode=function(t,n){function r(){if(n=i(n)||m.getTransport()){var e=R.get(c,h);if(e)return n.send(e.message)}var t=new f(u,p,null!=c?c:d,h,n);if(!m.emit("request",t))return t}function s(e,t,n){e.callback(t,n)}function a(e){clearTimeout(e),l(d,h)}if(!t)throw new TypeError("Message is not defined");try{t=e.unpack(t)}catch(e){return}var c=t.id,d=t.ack,u=t.method,p=t.params||{},h=p.from,v=p.dest;if(null==m.peerID||h!=m.peerID){if(null==c&&null==d){var b=new o(u,p);if(m.emit("request",b))return;return b}if(u){if(null==v||v==m.peerID){var E=O.get(d,h);if(E){var y=E.responseMethods;return u==y.error?s(E,p):u==y.response?s(E,null,p):r()}var g=I.get(d,h);if(g)return a(g)}return r()}var S=t.error,w=t.result;if(!(S&&S.dest&&S.dest!=m.peerID||w&&w.dest&&w.dest!=m.peerID)){if(!(E=O.get(d,h)))return(g=I.get(d,h))?a(g):void 0;s(E,S,w)}}}}var s=!1;if(Object.defineProperty)try{Object.defineProperty({},"x",{})}catch(e){s=!0}Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,i=function(){},o=function(){return n.apply(this instanceof i&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,o.prototype=new i,o});var a=e("events").EventEmitter,c=e("inherits"),d=e("./packers"),u=e("./Mapper"),p=5e3;c(r,a),r.RpcNotification=o,t.exports=r;var l=e("./clients"),f=e("./clients/transports");r.clients=l,r.clients.transports=f,r.packers=d},{"./Mapper":41,"./clients":42,"./clients/transports":44,"./packers":49,events:1,inherits:6}],47:[function(e,t,n){n.pack=function(e,t){var n={jsonrpc:"2.0"};if(e.method)n.method=e.method,e.params&&(n.params=e.params),null!=t&&(n.id=t);else if(null!=t){if(e.error){if(void 0!==e.result)throw new TypeError("Both result and error are defined");n.error=e.error}else{if(void 0===e.result)throw new TypeError("No result or error is defined");n.result=e.result}n.id=t}return JSON.stringify(n)},n.unpack=function(e){var t=e;("string"==typeof e||e instanceof String)&&(t=JSON.parse(e));var n=t.jsonrpc;if("2.0"!==n)throw new TypeError("Invalid JsonRPC version '"+n+"': "+e);if(null==t.method){if(null==t.id)throw new TypeError("Invalid message: "+e);var i=void 0!==t.result,o=void 0!==t.error;if(i&&o)throw new TypeError("Both result and error are defined: "+e);if(!i&&!o)throw new TypeError("No result or error is defined: "+e);t.ack=t.id,delete t.id}return t}},{}],48:[function(e,t,n){n.pack=function(e){throw new TypeError("Not yet implemented")},n.unpack=function(e){throw new TypeError("Not yet implemented")}},{}],49:[function(e,t,n){var i=e("./JsonRPC"),o=e("./XmlRPC");n.JsonRPC=i,n.XmlRPC=o},{"./JsonRPC":47,"./XmlRPC":48}],50:[function(e,t,n){function i(e,t,n){var i={audio:!1,video:{mandatory:{chromeMediaSource:e?"screen":"desktop",maxWidth:window.screen.width>1920?window.screen.width:1920,maxHeight:window.screen.height>1080?window.screen.height:1080},optional:[]}};return n&&(i.audio={mandatory:{chromeMediaSource:e?"screen":"desktop"},optional:[]}),t&&(i.video.mandatory.chromeMediaSourceId=t,i.audio&&i.audio.mandatory&&(i.audio.mandatory.chromeMediaSourceId=t)),i}function o(e){a?a.isLoaded?e?e.forEach?a.contentWindow.postMessage({captureCustomSourceId:e},"*"):a.contentWindow.postMessage({captureSourceIdWithAudio:!0},"*"):a.contentWindow.postMessage({captureSourceId:!0},"*"):setTimeout((function(){o(e)}),100):r((function(){o(e)}))}function r(e){a?e():((a=document.createElement("iframe")).onload=function(){a.isLoaded=!0,e()},a.src="https://openvidu.github.io/openvidu-screen-sharing-chrome-extension/",a.style.display="none",(document.body||document.documentElement).appendChild(a))}function s(){a?a.isLoaded?a.contentWindow.postMessage({getChromeExtensionStatus:!0},"*"):setTimeout(s,100):r(s)}var a;window.getScreenId=function(e,t,n){-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveOrOpenBlob&&!navigator.msSaveBlob?navigator.mozGetUserMedia?t(null,"firefox",{video:{mozMediaSource:e,mediaSource:e}}):(window.addEventListener("message",(function e(n){n.data&&(n.data.chromeMediaSourceId&&("PermissionDeniedError"===n.data.chromeMediaSourceId?t("permission-denied"):t(null,n.data.chromeMediaSourceId,i(null,n.data.chromeMediaSourceId,n.data.canRequestAudioTrack)),window.removeEventListener("message",e)),n.data.chromeExtensionStatus&&(t(n.data.chromeExtensionStatus,null,i(n.data.chromeExtensionStatus)),window.removeEventListener("message",e)))})),n?setTimeout((function(){o(n)}),100):setTimeout(o,100)):t({video:!0})},window.getScreenConstraints=function(e){r((function(){getScreenId((function(t,n,i){i||(i={video:!0}),e(t,i.video)}))}))},window.getChromeExtensionStatus=function(e){navigator.mozGetUserMedia?e("installed-enabled"):(window.addEventListener("message",(function t(n){n.data&&n.data.chromeExtensionStatus&&(e(n.data.chromeExtensionStatus),window.removeEventListener("message",t))})),setTimeout(s,100))},n.getScreenId=getScreenId},{}],51:[function(e,t,n){function i(e){if(!e)throw'"callback" parameter is mandatory.';if(r)return e(r);s=e,window.postMessage("get-sourceId","*")}function o(e,t){if(r="",c)return e(null,{mozMediaSource:"window",mediaSource:"window"});var n={mandatory:{chromeMediaSource:a,maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080},optional:[]};"desktop"!=a||r?("desktop"==a&&(n.mandatory.chromeMediaSourceId=r),e(null,n)):t?function(e){if(!e)throw'"callback" parameter is mandatory.';if(r)return e(r);s=e,window.postMessage("audio-plus-tab","*")}((function(t,i){n.mandatory.chromeMediaSourceId=t,i&&(n.canRequestAudioTrack=!0),e("PermissionDeniedError"==t?t:null,n)})):i((function(t){n.mandatory.chromeMediaSourceId=t,e("PermissionDeniedError"==t?t:null,n)}))}var r,s,a="screen",c=void 0!==window.InstallTrigger;window.opera||navigator.userAgent.indexOf(" OPR/"),window.chrome,window.addEventListener("message",(function(e){e.origin==window.location.origin&&function(e){if("PermissionDeniedError"==e){if(s)return s("PermissionDeniedError");throw new Error("PermissionDeniedError")}"rtcmulticonnection-extension-loaded"==e&&(a="desktop"),e.sourceId&&s&&s(r=e.sourceId,!0===e.canRequestAudioTrack)}(e.data)})),n.getScreenConstraints=o,n.getScreenConstraintsWithAudio=function(e){o(e,!0)},n.isChromeExtensionAvailable=function(e){if(e){if("desktop"==a)return e(!0);window.postMessage("are-you-there","*"),setTimeout((function(){e("screen"!=a)}),2e3)}},n.getChromeExtensionStatus=function(e,t){if(c)return t("not-chrome");2!=arguments.length&&(t=e,e="lfcgfepafnobdloecchnfaclibenjold");var n=document.createElement("img");n.src="chrome-extension://"+e+"/icon.png",n.onload=function(){a="screen",window.postMessage("are-you-there","*"),setTimeout((function(){t("screen"==a?"installed-disabled":"installed-enabled")}),2e3)},n.onerror=function(){t("not-installed")}},n.getSourceId=i},{}],52:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var r=e("freeice"),s=e("uuid"),a=e("platform"),c=function(){function e(e){var t=this;this.configuration=e,this.remoteCandidatesQueue=[],this.localCandidatesQueue=[],this.iceCandidateList=[],this.candidategatheringdone=!1,this.configuration.iceServers=this.configuration.iceServers&&this.configuration.iceServers.length>0?this.configuration.iceServers:r(),this.pc=new RTCPeerConnection({iceServers:this.configuration.iceServers}),this.id=e.id?e.id:s.v4(),this.pc.onicecandidate=function(e){if(e.candidate){var n=e.candidate;n?(t.localCandidatesQueue.push({candidate:n.candidate}),t.candidategatheringdone=!1,t.configuration.onicecandidate(e.candidate)):t.candidategatheringdone||(t.candidategatheringdone=!0)}},this.pc.onsignalingstatechange=function(){if("stable"===t.pc.signalingState)for(;t.iceCandidateList.length>0;)t.pc.addIceCandidate(t.iceCandidateList.shift())},this.start()}return e.prototype.start=function(){var e=this;return new Promise((function(t,n){if("closed"===e.pc.signalingState&&n('The peer connection object is in "closed" state. This is most likely due to an invocation of the dispose method before accepting in the dialogue'),e.configuration.mediaStream){if(a.isIonicIos)e.pc.addStream(e.configuration.mediaStream);else for(var i=0,o=e.configuration.mediaStream.getTracks();i<o.length;i++){var r=o[i];e.pc.addTrack(r,e.configuration.mediaStream)}t()}}))},e.prototype.dispose=function(e){try{if(this.pc){if("closed"===this.pc.signalingState)return;if(this.remoteCandidatesQueue=[],this.localCandidatesQueue=[],a.isIonicIos){for(var t=this.pc,n=0,i=t.getLocalStreams();n<i.length;n++){var o=i[n];e||o.stop(),t.removeStream(o)}for(var r=0,s=t.getRemoteStreams();r<s.length;r++){var c=s[r];c.track&&c.stop()}}else{for(var d=0,u=this.pc.getSenders();d<u.length;d++)o=u[d],e||o.track&&o.track.stop(),this.pc.removeTrack(o);for(var p=0,l=this.pc.getReceivers();p<l.length;p++)(c=l[p]).track&&c.track.stop()}this.pc.close()}}catch(e){}},e.prototype.generateOffer=function(){var e=this;return new Promise((function(t,n){var i,o=!0;e.configuration.mediaConstraints&&(i="boolean"!=typeof e.configuration.mediaConstraints.audio||e.configuration.mediaConstraints.audio,o="boolean"!=typeof e.configuration.mediaConstraints.video||e.configuration.mediaConstraints.video);var r={offerToReceiveAudio:"sendonly"!==e.configuration.mode&&i,offerToReceiveVideo:"sendonly"!==e.configuration.mode&&o};"Safari"===a.name&&-1!==a.ua.indexOf("Safari")?(i&&e.pc.addTransceiver("audio",{direction:e.configuration.mode}),o&&e.pc.addTransceiver("video",{direction:e.configuration.mode}),e.pc.createOffer().then((function(t){return e.pc.setLocalDescription(t)})).then((function(){var i=e.pc.localDescription;i?t(i.sdp):n("Local description is not defined")})).catch((function(e){return n(e)}))):e.pc.createOffer(r).then((function(t){return e.pc.setLocalDescription(t)})).then((function(){var i=e.pc.localDescription;i?t(i.sdp):n("Local description is not defined")})).catch((function(e){return n(e)}))}))},e.prototype.processAnswer=function(e,t){var n=this;return new Promise((function(i,o){var r={type:"answer",sdp:e};"closed"===n.pc.signalingState&&o("RTCPeerConnection is closed"),a.isIonicIos?t?setTimeout((function(){n.pc.setRemoteDescription(new RTCSessionDescription(r)).then((function(){return i()})).catch((function(e){return o(e)}))}),250):n.pc.setRemoteDescription(new RTCSessionDescription(r)).then((function(){return i()})).catch((function(e){return o(e)})):n.pc.setRemoteDescription(r).then((function(){return i()})).catch((function(e){return o(e)}))}))},e.prototype.addIceCandidate=function(e){var t=this;return new Promise((function(n,i){switch(t.remoteCandidatesQueue.push(e),t.pc.signalingState){case"closed":i(new Error("PeerConnection object is closed"));break;case"stable":t.pc.remoteDescription?t.pc.addIceCandidate(e).then((function(){return n()})).catch((function(e){return i(e)})):(t.iceCandidateList.push(e),n());break;default:t.iceCandidateList.push(e),n()}}))},e}();n.WebRtcPeer=c;var d=function(e){function t(t){return t.mode="recvonly",e.call(this,t)||this}return o(t,e),t}(c);n.WebRtcPeerRecvonly=d;var u=function(e){function t(t){return t.mode="sendonly",e.call(this,t)||this}return o(t,e),t}(c);n.WebRtcPeerSendonly=u;var p=function(e){function t(t){return t.mode="sendrecv",e.call(this,t)||this}return o(t,e),t}(c);n.WebRtcPeerSendrecv=p},{freeice:2,platform:8,uuid:9}],53:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("platform"),o=function(){function e(e){this.stream=e,this.webRtcStatsEnabled=!1,this.statsInterval=1,this.stats={inbound:{audio:{bytesReceived:0,packetsReceived:0,packetsLost:0},video:{bytesReceived:0,packetsReceived:0,packetsLost:0,framesDecoded:0,nackCount:0}},outbound:{audio:{bytesSent:0,packetsSent:0},video:{bytesSent:0,packetsSent:0,framesEncoded:0,nackCount:0}}}}return e.prototype.isEnabled=function(){return this.webRtcStatsEnabled},e.prototype.initWebRtcStats=function(){var e=this,t=localStorage.getItem("elastest-instrumentation");if(t){this.webRtcStatsEnabled=!0;var n=JSON.parse(t);return this.statsInterval=n.webrtc.interval,void(this.webRtcStatsIntervalId=setInterval((function(){e.sendStatsToHttpEndpoint(n)}),1e3*this.statsInterval))}},e.prototype.stopWebRtcStats=function(){this.webRtcStatsEnabled&&clearInterval(this.webRtcStatsIntervalId)},e.prototype.getSelectedIceCandidateInfo=function(){var e=this;return new Promise((function(t,n){e.getStatsAgnostic(e.stream.getRTCPeerConnection(),(function(o){if(-1!==i.name.indexOf("Chrome")||-1!==i.name.indexOf("Opera")){var r=void 0,s=void 0,a=void 0,c={},d={};for(var u in o){var p=o[u];"localcandidate"===p.type?c[p.id]=p:"remotecandidate"===p.type?d[p.id]=p:"googCandidatePair"===p.type&&"true"===p.googActiveConnection&&(a=p,r=p.localCandidateId,s=p.remoteCandidateId)}var l=c[r];if(l){var f=e.stream.getLocalIceCandidateList(),h=f.filter((function(e){return!!e.candidate&&e.candidate.indexOf(l.ipAddress)>=0&&e.candidate.indexOf(l.portNumber)>=0&&e.candidate.indexOf(l.priority)>=0}));l.raw=h[0]?h[0].candidate:"ERROR: Cannot find local candidate in list of sent ICE candidates"}else l="ERROR: No active local ICE candidate. Probably ICE-TCP is being used";var m=d[s];m?(h=(f=e.stream.getRemoteIceCandidateList()).filter((function(e){return!!e.candidate&&e.candidate.indexOf(m.ipAddress)>=0&&e.candidate.indexOf(m.portNumber)>=0&&e.candidate.indexOf(m.priority)>=0})),m.raw=h[0]?h[0].candidate:"ERROR: Cannot find remote candidate in list of received ICE candidates"):m="ERROR: No active remote ICE candidate. Probably ICE-TCP is being used",t({googCandidatePair:a,localCandidate:l,remoteCandidate:m})}else n("Selected ICE candidate info only available for Chrome")}),(function(e){n(e)}))}))},e.prototype.sendStatsToHttpEndpoint=function(e){var t=this,n=function(t){var n=new XMLHttpRequest,i=e.webrtc.httpEndpoint;n.open("POST",i,!0),n.setRequestHeader("Content-type","application/json"),n.onreadystatechange=function(){4===n.readyState&&n.status},n.send(t)};this.getStatsAgnostic(this.stream.getRTCPeerConnection(),(function(o){if(-1!==i.name.indexOf("Firefox"))o.forEach((function(i){var o={};if("inbound-rtp"===i.type&&null!==i.nackCount&&!1===i.isRemote&&i.id.startsWith("inbound")&&i.remoteId.startsWith("inbound")){var r="webrtc_inbound_"+i.mediaType+"_"+i.ssrc,s=1e3*i.jitter,a={bytesReceived:(i.bytesReceived-t.stats.inbound[i.mediaType].bytesReceived)/t.statsInterval,jitter:s,packetsReceived:(i.packetsReceived-t.stats.inbound[i.mediaType].packetsReceived)/t.statsInterval,packetsLost:(i.packetsLost-t.stats.inbound[i.mediaType].packetsLost)/t.statsInterval},c={bytesReceived:"bytes",jitter:"ms",packetsReceived:"packets",packetsLost:"packets"};"video"===i.mediaType&&(a.framesDecoded=(i.framesDecoded-t.stats.inbound.video.framesDecoded)/t.statsInterval,a.nackCount=(i.nackCount-t.stats.inbound.video.nackCount)/t.statsInterval,c.framesDecoded="frames",c.nackCount="packets",t.stats.inbound.video.framesDecoded=i.framesDecoded,t.stats.inbound.video.nackCount=i.nackCount),t.stats.inbound[i.mediaType].bytesReceived=i.bytesReceived,t.stats.inbound[i.mediaType].packetsReceived=i.packetsReceived,t.stats.inbound[i.mediaType].packetsLost=i.packetsLost,(o={"@timestamp":new Date(i.timestamp).toISOString(),exec:e.exec,component:e.component,stream:"webRtc",et_type:r,stream_type:"composed_metrics",units:c})[r]=a,n(JSON.stringify(o))}else"outbound-rtp"===i.type&&!1===i.isRemote&&i.id.toLowerCase().includes("outbound")&&(r="webrtc_outbound_"+i.mediaType+"_"+i.ssrc,a={bytesSent:(i.bytesSent-t.stats.outbound[i.mediaType].bytesSent)/t.statsInterval,packetsSent:(i.packetsSent-t.stats.outbound[i.mediaType].packetsSent)/t.statsInterval},c={bytesSent:"bytes",packetsSent:"packets"},"video"===i.mediaType&&(a.framesEncoded=(i.framesEncoded-t.stats.outbound.video.framesEncoded)/t.statsInterval,c.framesEncoded="frames",t.stats.outbound.video.framesEncoded=i.framesEncoded),t.stats.outbound[i.mediaType].bytesSent=i.bytesSent,t.stats.outbound[i.mediaType].packetsSent=i.packetsSent,(o={"@timestamp":new Date(i.timestamp).toISOString(),exec:e.exec,component:e.component,stream:"webRtc",et_type:r,stream_type:"composed_metrics",units:c})[r]=a,n(JSON.stringify(o)))}));else if(-1!==i.name.indexOf("Chrome")||-1!==i.name.indexOf("Opera"))for(var r=0,s=Object.keys(o);r<s.length;r++){var a=o[s[r]];if("ssrc"===a.type){var c={};if("bytesReceived"in a&&("audio"===a.mediaType&&"audioOutputLevel"in a||"video"===a.mediaType&&"qpSum"in a)){var d="webrtc_inbound_"+a.mediaType+"_"+a.ssrc,u={bytesReceived:(a.bytesReceived-t.stats.inbound[a.mediaType].bytesReceived)/t.statsInterval,jitter:a.googJitterBufferMs,packetsReceived:(a.packetsReceived-t.stats.inbound[a.mediaType].packetsReceived)/t.statsInterval,packetsLost:(a.packetsLost-t.stats.inbound[a.mediaType].packetsLost)/t.statsInterval},p={bytesReceived:"bytes",jitter:"ms",packetsReceived:"packets",packetsLost:"packets"};"video"===a.mediaType&&(u.framesDecoded=(a.framesDecoded-t.stats.inbound.video.framesDecoded)/t.statsInterval,u.nackCount=(a.googNacksSent-t.stats.inbound.video.nackCount)/t.statsInterval,p.framesDecoded="frames",p.nackCount="packets",t.stats.inbound.video.framesDecoded=a.framesDecoded,t.stats.inbound.video.nackCount=a.googNacksSent),t.stats.inbound[a.mediaType].bytesReceived=a.bytesReceived,t.stats.inbound[a.mediaType].packetsReceived=a.packetsReceived,t.stats.inbound[a.mediaType].packetsLost=a.packetsLost,(c={"@timestamp":new Date(a.timestamp).toISOString(),exec:e.exec,component:e.component,stream:"webRtc",et_type:d,stream_type:"composed_metrics",units:p})[d]=u,n(JSON.stringify(c))}else"bytesSent"in a&&(d="webrtc_outbound_"+a.mediaType+"_"+a.ssrc,u={bytesSent:(a.bytesSent-t.stats.outbound[a.mediaType].bytesSent)/t.statsInterval,packetsSent:(a.packetsSent-t.stats.outbound[a.mediaType].packetsSent)/t.statsInterval},p={bytesSent:"bytes",packetsSent:"packets"},"video"===a.mediaType&&(u.framesEncoded=(a.framesEncoded-t.stats.outbound.video.framesEncoded)/t.statsInterval,p.framesEncoded="frames",t.stats.outbound.video.framesEncoded=a.framesEncoded),t.stats.outbound[a.mediaType].bytesSent=a.bytesSent,t.stats.outbound[a.mediaType].packetsSent=a.packetsSent,(c={"@timestamp":new Date(a.timestamp).toISOString(),exec:e.exec,component:e.component,stream:"webRtc",et_type:d,stream_type:"composed_metrics",units:p})[d]=u,n(JSON.stringify(c)))}}}),(function(e){}))},e.prototype.standardizeReport=function(e){var t={};return-1!==i.name.indexOf("Firefox")?(Object.keys(e).forEach((function(e){})),e):(e.result().forEach((function(e){var n={id:e.id,timestamp:e.timestamp,type:e.type};e.names().forEach((function(t){n[t]=e.stat(t)})),t[n.id]=n})),t)},e.prototype.getStatsAgnostic=function(e,t,n){var o=this;return-1!==i.name.indexOf("Firefox")?e.getStats(null).then((function(e){var n=o.standardizeReport(e);t(n)})).catch(n):-1!==i.name.indexOf("Chrome")||-1!==i.name.indexOf("Opera")?e.getStats((function(e){var n=o.standardizeReport(e);t(n)}),null,n):void 0},e}();n.WebRtcStats=o},{platform:8}]},{},[17]);