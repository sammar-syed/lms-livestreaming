<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="" />
    <meta name="author" content="" />

    <title>SUPER CONTROL PANEL</title>

    <script
      src="https://code.jquery.com/jquery-3.3.1.min.js"
      integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
      crossorigin="anonymous"
    ></script>

    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="style1.css" rel="stylesheet" />

    <script src="./libs/socket.io.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="vendor/jquery/settings.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <script src="./common.js"></script>
    <script src="./socketmessage.js?v=007"></script>
  </head>

  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light static-top">
      <div class="container">
        <a class="navbar-brand logo" href="#">SUPER CONTROL PANEL</a>
        <button
          class="navbar-toggler"
          type="button"
          data-toggle="collapse"
          data-target="#navbarResponsive"
          aria-controls="navbarResponsive"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li>
              <button
                id="logout"
                style="margin-top: 2px; float: right"
                type="button"
                class="btn btn-danger btn-sm"
              >
                Log Out
              </button>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Page Content -->
    <div class="container">
      <div class="row">
        <div class="col-lg-4 col-md-4 col-sm-4 col-xl-4 clearfix">
          <div class="left-first">
            <div
              class="row box-border-title padding-bottom-reducer margin-top-reducer"
            >
              <span class="box-title">Group List</span>
              <a
                id="refreshCustomers"
                href="#"
                style="
                  position: absolute;
                  top: -14px;
                  background: #fff;
                  left: 282px;
                  padding: 0 5px;
                  color: black;
                "
                ><img
                  style="width: 20px; margin-right: 5px"
                  src="vendor/img/refresh.jpg"
              /></a>
              <div
                style="height: 25vh; overflow-y: auto"
                class="My-customers"
              ></div>
            </div>
          </div>
        </div>
        <div class="col-lg-4 col-md-4 col-sm-4 col-xl-4 clearfix">
          <div class="left-first">
            <div
              class="row box-border-title padding-bottom-reducer margin-top-reducer"
            >
              <span class="box-title">Users List</span>
              <a
                id="refreshContacts"
                href="#"
                style="
                  position: absolute;
                  top: -14px;
                  background: #fff;
                  left: 282px;
                  padding: 0 5px;
                  color: black;
                "
                ><img
                  style="width: 20px; margin-right: 5px"
                  src="vendor/img/refresh.jpg"
              /></a>
              <ul
                id="contactList"
                style="
                  height: 25vh;
                  list-style-type: none;
                  margin: 0;
                  padding: 0;
                "
                class="My-contacts"
              ></ul>
            </div>
          </div>
        </div>

        <div class="col-lg-4 col-md-4 col-sm-4 col-xl-4 clearfix">
          <div
            class="row box-border-title padding-bottom-reducer margin-top-reducer"
          >
            <span class="box-title">Create New Group</span>
            <div
              style="
                height: 19vh;
                overflow-y: auto;
                display: inline-block;
                width: 100%;
              "
            >
              <div class="form-group row">
                <label
                  class="col-md-4 col-form-label text-md-right"
                  for="exampleInputEmail1"
                  >User Name</label
                >
                <div class="col-md-8">
                  <input
                    type="text"
                    class="form-control"
                    id="ncname"
                    placeholder="User Name"
                  />
                </div>
              </div>
            </div>

            <input
              class="btn btn-secondary inBtn"
              style="margin: 0 auto; margin-top: 4px"
              id="createcst"
              type="button"
              name="commit"
              value="Create"
            />
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-lg-4 col-md-4 col-sm-4 col-xl-4 clearfix">
          <span class="box-title" style="margin-top: 29px"
            >Create New User</span
          >
          <div
            class="row box-border-title padding-bottom-reducer"
            style="height: 50vh; overflow-y: auto"
          >
            <div class="form-group row">
              <label
                class="col-md-4 col-form-label text-md-right"
                for="exampleInputEmail1"
                >Group Name</label
              >
              <div class="col-md-8">
                <input
                  type="text"
                  class="form-control"
                  disabled
                  id="cstname"
                  placeholder="User Name"
                />
              </div>
            </div>
            <div
              class="form-group row"
              style="margin-top: 0px; margin-bottom: 0px"
            >
              <label
                class="col-md-4 col-form-label text-md-right"
                for="exampleInputEmail1"
                >User Name</label
              >
              <div class="col-md-8">
                <input
                  type="text"
                  class="form-control"
                  id="name"
                  placeholder="User Name"
                />
              </div>
            </div>
            <div
              hidden
              class="form-group row"
              style="margin-top: 0px; margin-bottom: 0px"
            >
              <label
                class="col-md-4 col-form-label text-md-right"
                for="exampleInputEmail1"
                >User Number</label
              >
              <div class="col-md-8">
                <input
                  type="number"
                  class="form-control"
                  id="number"
                  placeholder="User Number"
                />
              </div>
            </div>
            <div
              hidden
              class="form-group row"
              style="margin-top: 0px; margin-bottom: 0px"
            >
              <label
                class="col-md-4 col-form-label text-md-right"
                for="exampleInputEmail1"
                >User Camera IP</label
              >
              <div class="col-md-8">
                <input
                  type="text"
                  class="form-control"
                  id="cip"
                  placeholder="User Camera IP"
                />
              </div>
            </div>
            <div
              class="form-group row"
              style="margin-top: 0px; margin-bottom: 0px"
            >
              <label
                class="col-md-4 col-form-label text-md-right"
                for="exampleInputPassword1"
                >Password</label
              >
              <div class="col-md-8">
                <input
                  type="password"
                  class="form-control"
                  id="npass"
                  placeholder="Password"
                />
              </div>
            </div>
            <div
              class="form-group row"
              style="margin-top: 0px; margin-bottom: 0px"
            >
              <label
                class="col-md-4 col-form-label text-md-right"
                for="exampleInputPassword1"
                >Confirm Password</label
              >
              <div class="col-md-8">
                <input
                  type="password"
                  class="form-control"
                  id="ncpass"
                  placeholder="Confirm Password"
                />
              </div>
            </div>
            <div
              class="form-group row video_custom"
              style="margin-top: 0px; margin-bottom: 0px"
            >
              <label
                class="col-md-4 col-form-label text-md-right"
                for="exampleInputPassword1"
                >Video 1
              </label>
              <div class="col-md-8">
                <input
                  type="file"
                  accept="video/*"
                  class="form-control"
                  id="video1"
                  placeholder="video1 Link"
                />
              </div>
            </div>
            <div
              class="form-group row video_custom"
              style="margin-top: 0px; margin-bottom: 0px"
            >
              <label
                class="col-md-4 col-form-label text-md-right"
                for="exampleInputPassword1"
                >Video 2
              </label>
              <div class="col-md-8">
                <input
                  type="file"
                  accept="video/*"
                  class="form-control"
                  id="video2"
                  placeholder="video2 Link"
                />
              </div>
            </div>
            <div
              class="form-group row video_custom"
              style="margin-top: 0px; margin-bottom: 0px"
            >
              <label
                class="col-md-4 col-form-label text-md-right"
                for="exampleInputPassword1"
                >Video 3
              </label>
              <div class="col-md-8">
                <input
                  type="file"
                  accept="video/*"
                  class="form-control"
                  id="video3"
                  placeholder="video3 Link"
                />
              </div>
            </div>
            <div
              class="form-group row video_custom"
              style="margin-top: 0px; margin-bottom: 0px"
            >
              <label
                class="col-md-4 col-form-label text-md-right"
                for="exampleInputPassword1"
                >Audio 1
              </label>
              <div class="col-md-8">
                <input
                  type="file"
                  accept="audio/*"
                  class="form-control"
                  id="audio1"
                  placeholder="Audio 1 Link"
                />
              </div>
            </div>
            <div
              class="form-group row video_custom"
              style="margin-top: 0px; margin-bottom: 0px"
            >
              <label
                class="col-md-4 col-form-label text-md-right"
                for="exampleInputPassword1"
                >Audio 2
              </label>
              <div class="col-md-8">
                <input
                  type="file"
                  accept="audio/*"
                  class="form-control"
                  id="audio2"
                  placeholder="Audio 2 Link"
                />
              </div>
            </div>

            <div class="form-group row">
              <label class="col-md-4 col-form-label text-md-right"
                >Role Type</label
              >
              <br />
              <div
                id="role-group"
                class="col-lg-8 col-md-8 clearfix"
                data-toggle="buttons"
              >
                <label id="lblusr" class="btn btn-light active">
                  <input
                    style="pointer-events: none"
                    type="radio"
                    name="role"
                    value="Client"
                    id="role1"
                    checked
                  />
                  Client
                </label>
                <label id="lbladmn" class="btn btn-light">
                  <input
                    style="pointer-events: none"
                    type="radio"
                    name="role"
                    value="Master"
                    id="role2"
                  />
                  Master
                </label>
              </div>
            </div>
            <div class="form-group row">
              <input
                class="btn btn-secondary inBtn"
                style="margin: 0 auto; margin-right: 5px; height: 38px"
                id="clear-u"
                type="button"
                name="commit"
                value="Clear"
              />
              <input
                class="btn btn-secondary inBtn"
                style="margin: 0 auto; margin-left: 5px; height: 38px"
                id="create"
                type="button"
                name="commit"
                value="Create"
              />
            </div>
          </div>
        </div>
        <div class="col-lg-4 col-md-4 clearfix">
          <span class="box-title" style="margin-top: 29px"
            >Change Password</span
          >
          <div
            class="row box-border-title padding-bottom-reducer"
            style="height: 50vh; overflow-y: auto"
          >
            <div class="form-group">
              <label for="exampleInputEmail1">User Name</label>
              <input
                type="text"
                class="form-control"
                id="cname"
                placeholder="User Name"
              />
            </div>
            <div class="form-group">
              <label for="exampleInputPassword1">New Password</label>
              <input
                type="password"
                class="form-control"
                id="pass"
                placeholder="New Password"
              />
            </div>
            <div class="form-group">
              <label for="exampleInputPassword1">Confirm New Password</label>
              <input
                type="password"
                class="form-control"
                id="cpass"
                placeholder="Confirm Password"
              />
            </div>
            <div class="form-group row">
              <input
                class="btn btn-secondary inBtn"
                style="
                  margin: 0 auto;
                  margin-right: 5px;
                  height: 38px;
                  margin-top: 20px;
                "
                id="clear-p"
                type="button"
                name="commit"
                value="Clear"
              />
              <input
                class="btn btn-secondary inBtn"
                style="
                  margin: 0 auto;
                  margin-left: 5px;
                  height: 38px;
                  margin-top: 20px;
                "
                id="change"
                type="button"
                name="commit"
                value="Change"
              />
            </div>
          </div>
        </div>
        <div class="col-lg-4 col-md-4 clearfix">
          <span class="box-title" style="margin-top: 29px">Change Group</span>
          <div
            class="row box-border-title padding-bottom-reducer"
            style="height: 50vh; overflow-y: auto"
          >
            <div class="form-group">
              <label for="exampleInputEmail1">User Name</label>
              <input
                type="text"
                class="form-control"
                id="usersName"
                placeholder="User Name"
              />
            </div>
            <div class="form-group">
              <label for="exampleInputEmail1">Select Group</label>
              <div class="My-group"></div>
            </div>

            <div class="form-group row">
              <input
                class="btn btn-secondary inBtn"
                style="
                  margin: 0 auto;
                  margin-right: 5px;
                  margin-top: 142px;
                  height: 38px;
                "
                id="clear-g"
                type="button"
                name="commit"
                value="Clear"
              />
              <input
                class="btn btn-secondary inBtn"
                style="
                  margin: 0 auto;
                  margin-left: 5px;
                  margin-top: 142px;
                  height: 38px;
                "
                id="change-g"
                type="button"
                name="commit"
                value="Change"
              />
            </div>
          </div>
        </div>

        <div class="col-lg-4 col-md-4 col-sm-4 col-xl-4 clearfix">
          <div hidden class="row box-border-title padding-bottom-reducer">
            <span class="box-title">Channel List</span>
            <a
              id="refreshChannels"
              href="#"
              style="
                position: absolute;
                top: -14px;
                background: #fff;
                left: 282px;
                padding: 0 5px;
                color: black;
              "
            >
              <img
                style="width: 20px; margin-right: 5px"
                src="vendor/img/refresh.jpg"
              />Refresh</a
            >
            <ul
              id="channelList"
              style="
                height: 40vh;
                list-style-type: none;
                margin: 0;
                padding: 0;
                width: 98% !important;
              "
              class="My-channels"
            ></ul>
          </div>
        </div>
      </div>
    </div>

    <script src="videoAdd.js"></script>
    <script src="serverConfig.js"></script>

    <script>
      var user;

      var socket = getSocket();

      var user;
      var contacts = "";
      var name;
      var cid;
      var customers = "";
      var group = "";
      var cname;
      var ncid;
      var url = apiServer;
      var usersCache = {}; //缓存所有用户信息
      $(function () {
        $("#contactList").sortable({
          update: function (event, ui) {
            $("#contactList li").each(function (index) {
              var id = $(this).text().split(" - ")[1].split("Status")[0];
              console.log(
                "superadmin.html sortable() $(this).text() => ",
                $(this).text()
              );
              console.log("superadmin.html sortable() id => ", id);
              var u = url + "/sort/?sort_id=" + index + "&userid=" + id;
              $.ajax({
                type: "get",
                url: u,
                success: function (d) {
                  console.log("Success");
                },
              });
            });
          },
        });
        $("#contactList").disableSelection();
      });

      $(document).ready(function () {
        var p = location.search.split("user=")[1];
        console.log("superadmin.html location.search => ", location.search);
        console.log("superadmin.html p => ", p);
        var user = p.split("&name=")[0];
        name = p.split("&name=")[1];
        console.log("superadmin.html user => ", user);
        console.log("superadmin.html name => ", name);

        $("#userid").val(user);
        $("#username").append(name); //在每个 id=username 元素结尾插入内容
        $("#number").append(user);
        if (user) {
          getUserInfoByUserId(
            user,
            function () {},
            function () {}
          );
          console.log("storage set");
        }

        $("#logout").click(function () {
          changeStatus(0);
        });

        function changeStatus(v) {
          var u = url + "/active/?active=" + v + "&userid=" + user.userid;
          $.ajax({
            type: "get",
            url: u,
            success: function (d) {
              window.location.replace("index.html");
            },
          });
        }

        $("#refreshContacts").click(function () {
          fetchContacts();
        });

        $("#refreshCustomers").click(function () {
          fetchCustomers();
        });

        fetchCustomers();
        //Change Group栏，加载所有分组信息
        fetchGroup();

        //获取分组
        function fetchCustomers() {
          customers = "";
          var u = url + "/customerList/";
          console.log("fetchCustomers=>", url);
          $.ajax({
            type: "get",
            url: u,
            success: function (d) {
              console.log("superadmin.html 获取分组 fetchCustomers() d => ", d);
              if (d.length > 0) cid = d[0].id;
              cname = d[0].name.toUpperCase();
              $("#cstname").val(cname);
              ncid = d[d.length - 1].userid + 1;
              fetchContacts(); //默认获取第1个分组中的联系人
              fetchChannels();
              for (var u = 0; u < d.length; u++) {
                var nm = d[u].name.toUpperCase();
                var id = d[u].id;
                customers +=
                  '<div id="' +
                  nm +
                  "-" +
                  id +
                  '" style="height:35px;" class="item-call-list simple-bg cstdv"><div class="left-area-status"><p class="f-weight-700">' +
                  nm +
                  "</p></div></div>";
              }
              $(".My-customers").html(customers);
            },
          });
        }
        //获取联系人
        function fetchContacts() {
          contacts = "";
          var user = {};
          var u = url + "/users/?cid=" + cid;
          $.ajax({
            type: "get",
            url: u,
            success: function (d) {
              console.log(
                "superadmin.html 获取联系人 fetchContacts() d => ",
                d
              );
              if (d.length > 0)
                for (var u = 0; u < d.length; u++) {
                  user = d[u];
                  var nm = d[u].name.toUpperCase();
                  var act =
                    d[u].active == 1
                      ? " Online"
                      : d[u].active == 2
                      ? " Busy"
                      : " Offline";
                  var id = d[u].userid;
                  var tp = d[u].type == 1 ? "Teacher" : "Student";
                  var st =
                    act == " Online"
                      ? ' style="background:green !important" '
                      : "";

                  //缓存用户信息，为切换分组使用
                  usersCache[id] = user;

                  contacts +=
                    '<li  id="cnt-' +
                    id +
                    '" class="item-call-list simple-bg" ' +
                    st +
                    '><div style="float:left;margin-right:10px;"><div class="elps"></div><div class="elps"></div><div class="elps"></div></div><div class="left-area-status"><p class="f-weight-700">' +
                    nm +
                    " - " +
                    id +
                    "</p><p><span>" +
                    tp +
                    " :</span><span>" +
                    act +
                    '</span></p></div><div style="float:left" class="right-area-status"><a id="s-' +
                    id +
                    '" class="end-call-button cntbtn" href="#"><img hidden id="usi' +
                    id +
                    '" src="vendor/img/' +
                    act +
                    '.png"></a></div><div class="right-area-status"><a id="d-' +
                    id +
                    '" class="end-call-button delbtn" href="#"><img id="del' +
                    id +
                    '" src="vendor/img/deleteUser.svg" title="delete" style="width: 20px; height: 20px;"></a>' +
                    '<a id="k-' +
                    id +
                    '" class="end-call-button kickbtn" href="#"><img id="kick' +
                    id +
                    '" src="vendor/img/kickUser.svg" title="kick" style="width: 25px; height: 25px;"></a>' +
                    '<input class="btn btn-secondary chgbtn" style="width: 100px;line-height:30px;font-size: 12px; margin: 5px 0 0 10px;padding: 0;" id="chgGrp-' +
                    id +
                    '" type="button" name="commit" value="Switch Group"></div>' +
                    "</li>";
                }
              $(".My-contacts").html(contacts);
            },
          });
        }

        function fetchChannels() {
          channels = "";
          var u = url + "/getChannels/?cid=" + cid;
          $.ajax({
            type: "get",
            url: u,
            success: function (d) {
              console.log("superadmin.html fetchChannels() d => ", d);
              if (d.length > 0)
                for (var u = 0; u < d.length; u++) {
                  var nm = d[u].chName.toUpperCase();
                  var id = d[u].id;
                  channels +=
                    '<li id="ch-' +
                    id +
                    '" class="item-call-list simple-bg"><div style="float:left;margin-right:10px;"></div><div class="left-area-status" style="width:85% !important"><p class="f-weight-700">' +
                    nm +
                    "</p><p><span>Link: </span><span>" +
                    d[u].chLink +
                    '</span></p></div><div class="right-area-status"><a id="dCh-' +
                    id +
                    '" class="end-call-button delCh" href="#"><img id="delCh' +
                    id +
                    '" src="vendor/img/del.png"></a></div></li>';
                }
              $(".My-channels").html(channels);
            },
          });
        }

        //Change Group栏，加载所有分组信息
        function fetchGroup() {
          group =
            '<div class="group"><select class="form-control" id="selectGroup">';
          var u = url + "/customerList/";
          console.log("fetchGroup=>", url);
          $.ajax({
            type: "get",
            url: u,
            success: function (d) {
              console.log("superadmin.html 获取分组 fetchGroup() d => ", d);
              for (var u = 0; u < d.length; u++) {
                var nm = d[u].name.toUpperCase();
                var id = d[u].id;
                group +=
                  '<option class="groupLi" value="' +
                  id +
                  '">' +
                  nm +
                  "</option>";
              }
              group += "</select></div>";
              $(".My-group").html(group);
            },
          });
        }

        $(document).on("click", ".cstdv", function () {
          var i = $(this).attr("id");
          cid = i.split("-")[1];
          cname = i.split("-")[0];
          $("#cstname").val(cname);
          fetchContacts();
          fetchChannels();
        });

        $(document).on("click", ".delbtn", function () {
          var r = confirm("Are you sure you want to delete this user?");
          if (r == true) {
            var i = $(this).attr("id");
            var id = i.split("-")[1];
            var u = url + "/delUser/?userid=" + id;
            $.ajax({
              type: "get",
              url: u,
              success: function (d) {
                fetchContacts();
                console.log("Success");
              },
            });
          } else {
          }
        });
        $(document).on("click", ".kickbtn", function () {
          var r = confirm("Are you sure you want to kick this user?");
          if (r == true) {
            var i = $(this).attr("id");
            var id = i.split("-")[1];
            var u = url + "/kickUser/?userid=" + id;
            console.log("socket", socket);
            // socket.emit("kick", [{ "msg": "kick user", "userid": id }]);
            socket.emit("drawing", [
              { event: "kick", msg: "kick user", userid: id },
            ]);
            console.log("logout id = " + id);
            logout(id, function () {
              fetchContacts();
            });
            // $.ajax({
            //   type: 'get',
            //   url: u,
            //   success: function (d) {
            //     fetchContacts();
            //     console.log("Success");
            //   }
            // });
          } else {
          }
        });
        //点击切换分组，加载用户信息
        $(document).on("click", ".chgbtn", function () {
          var r = confirm(
            "Are you sure you want to switch this user to another group?"
          );
          if (r == true) {
            var i = $(this).attr("id");
            console.log("superadmin.html 切换分组动作 i => ", i);
            var id = i.split("-")[1];
            console.log(
              "superadmin.html 切换分组动作 user => ",
              usersCache[id]
            );
            var name = usersCache[id].name.toUpperCase() + "-" + id;
            $("#usersName").val(name);
          } else {
          }
        });
        //切换分组，点击切换按钮时
        $("#change-g").click(function () {
          var userName = $("#usersName").val();
          var userId = userName.split("-")[1];

          var groupId = $("#selectGroup").val();
          console.log(
            "superadmin.html 切换分组 提交信息 userName => ",
            userName
          );
          console.log("superadmin.html 切换分组 提交信息 userId => ", userId);
          // console.log('superadmin.html 切换分组 提交信息 分组cid => ', cid)
          console.log("superadmin.html 切换分组 提交信息 groupId => ", groupId);

          var u = url + "/change_group/?cid=" + groupId + "&userid=" + userId;
          $.ajax({
            type: "get",
            url: u,
            success: function (d) {
              fetchContacts();
              $("#usersName").val("");
              $("#selectGroup").each(function () {
                $(this).find("option").eq(0).prop("selected", true);
              });
              console.log("Success");
            },
          });
        });
        //切换分组，点击清除
        $("#clear-g").click(function () {
          $("#usersName").val("");

          $("#selectGroup").each(function () {
            $(this).find("option").eq(0).prop("selected", true);
          });
        });

        $(document).on("click", ".delCh", function () {
          var r = confirm("Are you sure you want to delete this channel?");
          if (r == true) {
            var i = $(this).attr("id");
            var id = i.split("-")[1];
            var u = url + "/delChannels/?id=" + id;
            $.ajax({
              type: "get",
              url: u,
              success: function (d) {
                fetchChannels();
                console.log("Success");
              },
            });
          } else {
          }
        });

        $(document).on("click", ".cntbtn", function () {
          var s =
            $(this).html().indexOf("Online") != -1
              ? 0
              : $(this).html().indexOf("Busy") != -1
              ? 1
              : -1;
          if (s != -1) {
            if (s == 0)
              $(this).html(
                $(this)
                  .html()
                  .replace("Online", "Offline")
                  .replace("Online", "Offline")
              );
            else
              $(this).html(
                $(this)
                  .html()
                  .replace("Busy", "Online")
                  .replace("Busy", "Online")
              );
            var i = $(this).attr("id");
            var id = i.split("-")[1];
            var u = url + "/active/?active=" + s + "&userid=" + id;
            $.ajax({
              type: "get",
              url: u,
              success: function (d) {
                console.log("Success");
              },
            });
          }
        });

        $("#clear-p").click(function () {
          $("#cname").val("");
          $("#cpass").val("");
          $("#pass").val("");
        });

        $("#change").click(function () {
          var n = $("#cname").val();
          var cp = $("#cpass").val();
          var p = $("#pass").val();
          if (p !== "" && n != "" && p == cp) {
            var u = url + "/change/?name=" + n + "&pass=" + p;
            $.ajax({
              type: "get",
              url: u,
              success: function (d) {
                console.log("Success");
                if (d.affectedRows == 1)
                  alert("User password changed successfuly.");
                else alert("User password change failed.");
              },
            });
          } else alert("Please fill all required fields correctly.");
        });

        $("#clear-u").click(function () {
          $("#name").val("");
          $("#npass").val("");
          $("#ncpass").val("");
          $("#cip").val("");
          $("#number").val("");
        });

        $("#create").click(function () {
          var n = $("#name").val();
          var p = $("#npass").val();
          var cp = $("#ncpass").val();
          var ip = $("#cip").val();
          var nm = $("#number").val();
          if (nm.length != 4) {
            nm = Math.floor(1000 + Math.random() * 9000);
          }
          var t = $("#lblusr").hasClass("active") ? 0 : 1;
          if (p !== "" && n != "" && p == cp) {
            var u =
              url +
              "/create/?name=" +
              n +
              "&type=" +
              t +
              "&pass=" +
              p +
              "&num=" +
              nm +
              "&cid=" +
              cid +
              "&ip=" +
              ip;
            $.ajax({
              type: "get",
              url: u,
              success: function (d) {
                if (d.affectedRows == 1) {
                  alert("User created successfuly.");
                  fetchContacts();
                } else alert("User creation failed.");
              },
            });
          } else alert("Please fill all required fields correctly.");
        });

        $("#refreshChannels").click(function () {
          fetchChannels();
        });

        $("#chAdd").click(function () {
          var n = $("#chName").val();
          var l = $("#chLink").val();
          if (n.length >= 3 && l.length >= 10) {
            var u =
              url + "/chCreate/?chName=" + n + "&cid=" + cid + "&chLink=" + l;
            $.ajax({
              type: "get",
              url: u,
              success: function (d) {
                if (d.affectedRows == 1) {
                  alert("Channel created successfuly.");
                  fetchChannels();
                } else alert("Channel creation failed.");
              },
            });
          } else alert("Please enter correct channel name and link.");
        });

        $("#createcst").click(function () {
          var n = $("#ncname").val();
          if (!ncid) ncid = 1;
          if (n.length >= 3) {
            var u = url + "/createcst/?name=" + n + "&id=" + ncid;
            $.ajax({
              type: "get",
              url: u,
              success: function (d) {
                if (d.affectedRows == 1) {
                  alert("Group created successfuly.");
                  fetchCustomers();
                } else alert("Group creation failed.");
              },
            });
          } else alert("Please enter correct name.");
        });

        $("#logout").click(function () {
          changeStatus(0);
        });
      });
    </script>
  </body>
</html>
